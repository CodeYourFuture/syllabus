"use strict";(self.webpackChunkcodeyourfuture_syllabus=self.webpackChunkcodeyourfuture_syllabus||[]).push([[2397],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return h}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=d(n),m=r,h=p["".concat(s,".").concat(m)]||p[m]||c[m]||l;return n?a.createElement(h,o(o({ref:t},u),{},{components:n})):a.createElement(h,o({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[p]="string"==typeof e?e:r,o[1]=i;for(var d=2;d<l;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4630:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return i},metadata:function(){return d},toc:function(){return p}});var a=n(87462),r=n(63366),l=(n(67294),n(3905)),o=["components"],i={id:"mongodb-101",title:"MongoDB 101",sidebar_label:"MongoDB 101"},s=void 0,d={unversionedId:"workshops/mongodb-101",id:"workshops/mongodb-101",title:"MongoDB 101",description:"What we will learn today?",source:"@site/docs/workshops/mongodb-101.md",sourceDirName:"workshops",slug:"/workshops/mongodb-101",permalink:"/workshops/mongodb-101",draft:!1,editUrl:"https://github.com/CodeYourFuture/Syllabus-V2/edit/master/docs/workshops/mongodb-101.md",tags:[],version:"current",frontMatter:{id:"mongodb-101",title:"MongoDB 101",sidebar_label:"MongoDB 101"}},u={},p=[{value:"Before we start",id:"before-we-start",level:2},{value:"Lesson 1 - SQL and NoSQL",id:"lesson-1---sql-and-nosql",level:2},{value:"Lesson 2 - Why MongoDB",id:"lesson-2---why-mongodb",level:2},{value:"Lesson 3 - Basic Commands",id:"lesson-3---basic-commands",level:2},{value:"Databases",id:"databases",level:2},{value:"Collections and Documents",id:"collections-and-documents",level:2},{value:"Exercise 1",id:"exercise-1",level:3},{value:"Exercise 2",id:"exercise-2",level:3},{value:"Exercise 3",id:"exercise-3",level:3},{value:"Finding Documents",id:"finding-documents",level:3},{value:"Exercise 4a",id:"exercise-4a",level:3},{value:"Exercise 4b",id:"exercise-4b",level:3},{value:"Updating Documents",id:"updating-documents",level:3},{value:"Exercise 5",id:"exercise-5",level:3},{value:"Exercise 6",id:"exercise-6",level:3},{value:"Deleting documents",id:"deleting-documents",level:2},{value:"Exercise 7",id:"exercise-7",level:3},{value:"Exercise 8",id:"exercise-8",level:3},{value:"Lesson 4 - Administration",id:"lesson-4---administration",level:2},{value:"Scripting the shell",id:"scripting-the-shell",level:2},{value:"Exercise 9",id:"exercise-9",level:3},{value:"Aggregation",id:"aggregation",level:2},{value:"Exercise 10",id:"exercise-10",level:3},{value:"Replication",id:"replication",level:2},{value:"Sharding",id:"sharding",level:2},{value:"What&#39;s next",id:"whats-next",level:2},{value:"Shameless plug",id:"shameless-plug",level:3}],c={toc:p},m="wrapper";function h(e){var t=e.components,i=(0,r.Z)(e,o);return(0,l.kt)(m,(0,a.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"What we will learn today?")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"SQL vs NoSQL"),(0,l.kt)("li",{parentName:"ul"},"Why MongoDB?"),(0,l.kt)("li",{parentName:"ul"},"Mongo Shell Basic Commands"),(0,l.kt)("li",{parentName:"ul"},"MongoDB administration",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Aggregation"),(0,l.kt)("li",{parentName:"ul"},"Replication"),(0,l.kt)("li",{parentName:"ul"},"Sharding"))),(0,l.kt)("li",{parentName:"ul"},"What's next?")),(0,l.kt)("h2",{id:"before-we-start"},"Before we start"),(0,l.kt)("p",null,"Download and install MongoDB from\n",(0,l.kt)("a",{parentName:"p",href:"https://www.mongodb.com/download-center#community"},"https://www.mongodb.com/download-center#community"),".\nFollow the instructions for your platform (Windows, Linux or OS X)."),(0,l.kt)("p",null,"Open two instances of terminal.\nRun ",(0,l.kt)("inlineCode",{parentName:"p"},"mongod")," in the first instance - this will start MongoDB."),(0,l.kt)("p",null,"In the second instance, first download the sample data script:\n",(0,l.kt)("inlineCode",{parentName:"p"},"curl https://gist.githubusercontent.com/agiamas/35b2b954cc942f95709273d3cb9d2cf3/raw/b1bb399942dab287832d41b3b75f6b54c6f00bb1/mongodb_data.js > mongo_data.js")),(0,l.kt)("p",null,"then import the data we just downloaded using"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"mongo < mongo_data.js\n")),(0,l.kt)("p",null,"Finally, run ",(0,l.kt)("inlineCode",{parentName:"p"},"mongo")," in the second terminal instance."),(0,l.kt)("h2",{id:"lesson-1---sql-and-nosql"},"Lesson 1 - SQL and NoSQL"),(0,l.kt)("p",null,"SQL is a well known paradigm in data storage and retrieval, serving us for decades.\nOur data was living in mainframes and being stored and processed in isolation.\nThe nature of Web and mobile has created a paradigm shift in the past decade.\nData has exploded in volume, veracity and velocity.\nWe have many times semi-structured data of varying quality\nand unpredictable volumes of them."),(0,l.kt)("p",null,"This has led to a new breed of databases, the NoSQL ones."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Document databases, e.g. MongoDB"),(0,l.kt)("li",{parentName:"ul"},"Graph stores, e.g. Neo4J"),(0,l.kt)("li",{parentName:"ul"},"key-value stores, e.g. Redis"),(0,l.kt)("li",{parentName:"ul"},"Wide-column stores , e.g. Cassandra")),(0,l.kt)("p",null,"In this class we will examine Document databases and its most popular one, MongoDB."),(0,l.kt)("p",null,"First of all, how does MongoDB compare with traditional SQL queries\nthat we have learned in the past?"),(0,l.kt)("p",null,(0,l.kt)("a",{target:"_blank",href:n(30575).Z},"MongoDB to SQL Mapping")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://s3.amazonaws.com/info-mongodb-com/sql_to_mongo.pdf"},"https://s3.amazonaws.com/info-mongodb-com/sql_to_mongo.pdf")),(0,l.kt)("h2",{id:"lesson-2---why-mongodb"},"Lesson 2 - Why MongoDB"),(0,l.kt)("p",null,"MongoDB is a leader in NoSQL database space."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"de facto leader in NoSQL database space."),(0,l.kt)("li",{parentName:"ul"},"uses JSON, you are familiar with json in FE/Node, you can use it in DB layer too!"),(0,l.kt)("li",{parentName:"ul"},"one language to rule them all, part of MEAN stack"),(0,l.kt)("li",{parentName:"ul"},"mongodb data types as compared to JSON",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.mongodb.com/manual/reference/bson-types/"},"https://docs.mongodb.com/manual/reference/bson-types/")),(0,l.kt)("li",{parentName:"ul"},"We can even query by type!\n",(0,l.kt)("a",{parentName:"li",href:"https://docs.mongodb.com/manual/reference/operator/query/type/"},"https://docs.mongodb.com/manual/reference/operator/query/type/"))))),(0,l.kt)("h2",{id:"lesson-3---basic-commands"},"Lesson 3 - Basic Commands"),(0,l.kt)("p",null,"Open the terminal that you ran ",(0,l.kt)("inlineCode",{parentName:"p"},"mongo"),".\nFirst type ",(0,l.kt)("inlineCode",{parentName:"p"},"show dbs")),(0,l.kt)("p",null,"You should see something similar to:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"admin          0.000GB\nlocal          0.000GB\n")),(0,l.kt)("p",null,"Then type ",(0,l.kt)("inlineCode",{parentName:"p"},"use cyf")),(0,l.kt)("p",null,"You should now get:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"switched to db cyf\n")),(0,l.kt)("p",null,"That's it! You have created a new database."),(0,l.kt)("p",null,"Now type again ",(0,l.kt)("inlineCode",{parentName:"p"},"show dbs")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"admin          0.000GB\nlocal          0.000GB\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"??? Where is our new database? ???")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Lazy initialisation.")),(0,l.kt)("h2",{id:"databases"},"Databases"),(0,l.kt)("h2",{id:"collections-and-documents"},"Collections and Documents"),(0,l.kt)("p",null,"Collections are like tables in SQL databases.\nInitialising a collection is also happening lazily like this:"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"> db.Student.insert({name: 'alex'})")),(0,l.kt)("p",null,"Now if we run again ",(0,l.kt)("inlineCode",{parentName:"p"},"show dbs")," after we create a collection with a document\nwe will see that the database appears in the list.\nThis is because at the moment that we inserted this document,\nthe document was created, which in turn created the collection\nwhich in turn created the database."),(0,l.kt)("h3",{id:"exercise-1"},"Exercise 1"),(0,l.kt)("p",null,"Insert a new student with name: Mary"),(0,l.kt)("h3",{id:"exercise-2"},"Exercise 2"),(0,l.kt)("p",null,"Insert a new student with name: Madeline and id=2 (integer)"),(0,l.kt)("h3",{id:"exercise-3"},"Exercise 3"),(0,l.kt)("p",null,"Insert a new student with name: Steve, midterm score of 80 and final score of 100"),(0,l.kt)("p",null,"Scores should be embedded in a sub-document like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"scores:\n{\n  midterm: 0,\n  final: 0\n}\n")),(0,l.kt)("h3",{id:"finding-documents"},"Finding Documents"),(0,l.kt)("p",null,"Finding a document by a single attribute:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"> db.Student.find({name: 'alex'})\n")),(0,l.kt)("p",null,"Querying embedded attributes:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'> db.Student.find({"scores.midterm": {$gte: 40}} )\n')),(0,l.kt)("p",null,"AND / OR queries:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'> db.Student.find({"$or": [{"scores.midterm": {$gt: 60}}, {"scores.final": {$lte: 75}}]} )\n')),(0,l.kt)("h3",{id:"exercise-4a"},"Exercise 4a"),(0,l.kt)("p",null,"Find the user Mary that you inserted in exercise 1"),(0,l.kt)("h3",{id:"exercise-4b"},"Exercise 4b"),(0,l.kt)("p",null,"Search for students that have scored between [50,80)\nin midterm AND ","[80,100]"," in final exam"),(0,l.kt)("p",null,"In these two examples above we can see the operators\nGreaterThanEquals >=, GreaterThan > and LessThanEquals <= in action."),(0,l.kt)("p",null,"All operators in MongoDB:\n",(0,l.kt)("a",{parentName:"p",href:"https://docs.mongodb.com/manual/reference/operator/query/"},"https://docs.mongodb.com/manual/reference/operator/query/")),(0,l.kt)("h3",{id:"updating-documents"},"Updating Documents"),(0,l.kt)("p",null,"Updating documents has 2 parts.\nThe first one is finding the document(s) we want to update\nand the second one is modifying their values."),(0,l.kt)("p",null,"(!)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"db.Student.update({name: 'alex'}, {name: 'alexander'})\n")),(0,l.kt)("p",null,"What will this command do?"),(0,l.kt)("p",null,"REPLACE the first instance of document matching {name:'alex'}\nwith the new {name:'alexander'} !!!!"),(0,l.kt)("p",null,"Definitely not what we want..."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"> db.Student.update({name: 'alex'}, {$set: {name: 'alexander'}})\n")),(0,l.kt)("p",null,"We can also use other operators like $inc, $mul, $min, $max"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://docs.mongodb.com/manual/reference/operator/update/#fields"},"https://docs.mongodb.com/manual/reference/operator/update/#fields")),(0,l.kt)("p",null,"(!) Update by default will update only the first instance it matches.\nmulti:true"),(0,l.kt)("p",null,"(!) We can get update to update or ",(0,l.kt)("em",{parentName:"p"},"create")," the document by using upsert:true"),(0,l.kt)("h3",{id:"exercise-5"},"Exercise 5"),(0,l.kt)("p",null,"Update the student madeline that you created back in exercise 2\nto have midterm score of 50 and final score of 100 respectively."),(0,l.kt)("h3",{id:"exercise-6"},"Exercise 6"),(0,l.kt)("p",null,"Update the grades of all students to be 90"),(0,l.kt)("p",null,"(!) How could we boost the grades of all students by 10%? (!)"),(0,l.kt)("h2",{id:"deleting-documents"},"Deleting documents"),(0,l.kt)("p",null,"Deleting a single or more documents is as simple as:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'> db.Student.remove({"_id":ObjectId("5a99e1209056c9e237d071d9")})\nWriteResult({ "nRemoved" : 1 })\n')),(0,l.kt)("p",null,"Deleting a whole collection:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"db.Student.drop()\n")),(0,l.kt)("p",null,"Deleting a database:\n",(0,l.kt)("inlineCode",{parentName:"p"},"db.dropDatabase()")," to delete the current database"),(0,l.kt)("h3",{id:"exercise-7"},"Exercise 7"),(0,l.kt)("p",null,"Delete user steve that you created back in exercise 3"),(0,l.kt)("h3",{id:"exercise-8"},"Exercise 8"),(0,l.kt)("p",null,"Delete all users with midterm score less than 80"),(0,l.kt)("h2",{id:"lesson-4---administration"},"Lesson 4 - Administration"),(0,l.kt)("h2",{id:"scripting-the-shell"},"Scripting the shell"),(0,l.kt)("p",null,"There are several ways to write scripts for MongoDB shell:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"use ",(0,l.kt)("inlineCode",{parentName:"li"},"mongo < mongo_script.sh")),(0,l.kt)("li",{parentName:"ul"},"use ",(0,l.kt)("inlineCode",{parentName:"li"},"mongo mongo_script.js"))),(0,l.kt)("p",null,"What's the difference?"),(0,l.kt)("p",null,"The first one will pipe in our script and execute its lines one by one\nas if we were typing them in Mongo shell."),(0,l.kt)("p",null,"The second one will evaluate our javascript and attempt to run it with Mongo shell."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Always")," test scripts locally in MongoDB (and in general)."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Always")," test in staging before production."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Always")," keep backups in production.\nAnd test that you can restore from these backups regualarly."),(0,l.kt)("p",null,"All of these are important for every database system\nbut even more important in MongoDB as..."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"THERE IS NO ROLLBACK!")," There are no transactions.\nOnce you delete something, it's gone."),(0,l.kt)("h3",{id:"exercise-9"},"Exercise 9"),(0,l.kt)("p",null,"Using MongoDB shell, create a script to output in a new collection\nnamed BoostedStudents one document for every document in Student collection\nwith their final grade being boosted by 10%."),(0,l.kt)("h2",{id:"aggregation"},"Aggregation"),(0,l.kt)("p",null,"Why aggregation framework?"),(0,l.kt)("p",null,"Aggregation framework in MongoDB is modelled\nafter the familiar concept of data processing pipelines.\nDocuments enter the pipeline with the MongoDB structure\nand exit the other end transformed into BSON documents with calculated fields.\nCommands in a pipeline are executed sequentially\nand in the order that they appear in the array []."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"SQL"),(0,l.kt)("th",{parentName:"tr",align:null},"Aggregation framework"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"WHERE / HAVING"),(0,l.kt)("td",{parentName:"tr",align:null},"\\$match")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"GROUP BY"),(0,l.kt)("td",{parentName:"tr",align:null},"\\$group")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"SELECT"),(0,l.kt)("td",{parentName:"tr",align:null},"\\$project")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ORDER BY"),(0,l.kt)("td",{parentName:"tr",align:null},"\\$sort")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"LIMIT"),(0,l.kt)("td",{parentName:"tr",align:null},"\\$limit")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"sum() / count()"),(0,l.kt)("td",{parentName:"tr",align:null},"\\$sum")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"average()"),(0,l.kt)("td",{parentName:"tr",align:null},"\\$avg")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"join"),(0,l.kt)("td",{parentName:"tr",align:null},"\\$lookup")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},'db.students.aggregate([\n                   1.  { $match: { name: {$regex: /^aA/} } },\n                   2.  { $group: { _id: "$name", average: { $avg: "$scores.final" } } },\n                   3.  { $sort: { average: -1 } },\n                   4.  { $project: { name: 1, average: 1 } }\n                   ])\n')),(0,l.kt)("p",null,"What does the pipeline above do?"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"matches all documents with a name starting from aA"),(0,l.kt)("li",{parentName:"ol"},"groups them by average final score"),(0,l.kt)("li",{parentName:"ol"},"sorts them by average score"),(0,l.kt)("li",{parentName:"ol"},"projects(selects) name and average score in the output")),(0,l.kt)("p",null,"What's the output like?"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"{_id: .., name: .., average: ..}\n")),(0,l.kt)("p",null,"More information: ",(0,l.kt)("a",{parentName:"p",href:"https://docs.mongodb.com/manual/aggregation/"},"https://docs.mongodb.com/manual/aggregation/")),(0,l.kt)("h3",{id:"exercise-10"},"Exercise 10"),(0,l.kt)("p",null,"Now let's redo Exercise 9 using the aggregation framework."),(0,l.kt)("h2",{id:"replication"},"Replication"),(0,l.kt)("p",null,"Replication in MongoDB is used to increase redundancy and data availability.\nIn its essence it's a way for 3 or more (or even 2 with some caveats..)\nservers to keep the same copy of data."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"replication diagram",src:n(31389).Z,width:"620",height:"507"})),(0,l.kt)("p",null,"Writes always go to the primary and get propagated ",(0,l.kt)("em",{parentName:"p"},"asynchronously")," to the secondaries."),(0,l.kt)("p",null,"Reads can go to the primary or any of the secondaries."),(0,l.kt)("p",null,"Election process:"),(0,l.kt)("p",null,'Replica sets implement by default automatic failover.\nIf a primary server fails, the remaining secondaries will elect the new primary.\nThis will by default be the secondary that is most "up to date" with the primary\nbut we can affect (rig) the election process\nby assigning different votes to each server.'),(0,l.kt)("p",null,"More information:\n",(0,l.kt)("a",{parentName:"p",href:"https://docs.mongodb.com/manual/core/replica-set-elections/"},"https://docs.mongodb.com/manual/core/replica-set-elections/")),(0,l.kt)("p",null,"Using replication we can perform a few interesting tasks:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"delayed replica for backup.\nDelay backups by an hour, enabling us to recover from dropping a database in production"),(0,l.kt)("li",{parentName:"ul"},"hidden replicas for reporting.\nThese replicas will never become primaries\nso we can safely apply read load to them for reporting purposes"),(0,l.kt)("li",{parentName:"ul"},"replicas in different location for disaster recovery"),(0,l.kt)("li",{parentName:"ul"},"replicas in different location to be closer to our users")),(0,l.kt)("h2",{id:"sharding"},"Sharding"),(0,l.kt)("p",null,"Sharding is a method for horizontal scaling that MongoDB uses.\nIt essentially partitions data across the shard key in different servers\nthereby distributing the read and write load."),(0,l.kt)("p",null,"What is horizontal scaling?"),(0,l.kt)("p",null,"When our data exceeds the disk space, I/O capacity and/or memory available\nin a single server we have two options:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Buy/Rent a bigger server. This is vertical scaling.\nIt's of course the easiest way to scale\nbut does not scale linearly in terms of cost and capacity."),(0,l.kt)("li",{parentName:"ol"},"Distribute our data across different servers of the same initial capacity.\nThis is called horizontal scaling, is more difficult to achieve\nbut theoretically if we achieve linear scaling\nthen our system can be ",(0,l.kt)("strong",{parentName:"li"},"infinitely scaleable"),".")),(0,l.kt)("p",null,"With MongoDB it's important to understand that we will start with #1\nfor as long as it makes financial sense.\nIf we are on AWS it will probably be easier to tweak our replica set\nfrom S to M to L sized servers rether than implement sharding.\nAt some point though, we should start planning for sharding,\ndefinitely sooner rather than later."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"sharded architecture",src:n(73102).Z,width:"620",height:"440"})),(0,l.kt)("p",null,"Sharding as we can see from the diagram above is not a trivial task.\nWe need router(s) config servers and shards."),(0,l.kt)("p",null,"Router:"),(0,l.kt)("p",null,"The router is essentially our query server.\nQueries no longer go to individual servers\nbut must go to the router which will decide which server(s) hold our data."),(0,l.kt)("p",null,"Config Servers:"),(0,l.kt)("p",null,"Config servers are holding configuration information for the whole cluster.\nThey must be deployed as a replica set in order to achieve high availability."),(0,l.kt)("p",null,"Shards:"),(0,l.kt)("p",null,"Each shard is essentially a replica set.\nEach shard holds a cut of our data\nand all the shards together hold the total of our data."),(0,l.kt)("p",null,"More information:\n",(0,l.kt)("a",{parentName:"p",href:"https://docs.mongodb.com/manual/sharding/"},"https://docs.mongodb.com/manual/sharding/")),(0,l.kt)("h2",{id:"whats-next"},"What's next"),(0,l.kt)("p",null,"If you have time and interest,\nplease register to this class or any other class in MongoDB university."),(0,l.kt)("p",null,"All classes are ",(0,l.kt)("strong",{parentName:"p"},"free")," and on average require 6-10 hours of time per week."),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://university.mongodb.com/courses/M001/about"},"https://university.mongodb.com/courses/M001/about")),(0,l.kt)("h3",{id:"shameless-plug"},"Shameless plug"),(0,l.kt)("p",null,"I am also the author of the Mastering MongoDB 3.X book by Packt publishing,\navailable ",(0,l.kt)("a",{parentName:"p",href:"https://www.packtpub.com/big-data-and-business-intelligence/mastering-mongodb-3x"},"here"),"."))}h.isMDXComponent=!0},30575:function(e,t,n){t.Z=n.p+"assets/files/sql_to_mongo_mapping-26d8f53d2edf919b591aa7969e3e5e29.pdf"},31389:function(e,t,n){t.Z=n.p+"assets/images/replica-set-read-write-operations-primary.bakedsvg-b0636f564771ff7599c18ad45c579f74.svg"},73102:function(e,t,n){t.Z=n.p+"assets/images/sharded-cluster-production-architecture.bakedsvg-e73a63fbf0ad53e251a1747a52138f59.svg"}}]);