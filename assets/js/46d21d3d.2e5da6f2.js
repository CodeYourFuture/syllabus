"use strict";(self.webpackChunkcodeyourfuture_syllabus=self.webpackChunkcodeyourfuture_syllabus||[]).push([[3496],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=d(n),m=o,h=c["".concat(s,".").concat(m)]||c[m]||u[m]||i;return n?a.createElement(h,r(r({ref:t},p),{},{components:n})):a.createElement(h,r({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:o,r[1]=l;for(var d=2;d<i;d++)r[d]=n[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},57723:function(e,t,n){n.d(t,{Z:function(){return o}});var a=n(67294);function o(e){var t="https://docs.google.com/forms/d/e/1FAIpQLScq8Zgr0pz7aMDj0D768eCpW798XgtDsKfpA6BquqK5Hdtj4A/viewform?embedded=true&entry.1672476057="+e.module.replace(" ","+")+"&entry.74981796="+e.week.replace(" ","+");return a.createElement("div",{className:"feedback"},a.createElement("div",{className:"feedback__wrapper"},a.createElement("iframe",{src:t,width:"640",height:"640",frameborder:"0",marginheight:"0",marginwidth:"0"},"Loading\u2026"),a.createElement("center",null,a.createElement("p",null,"Not loading? Form can be found"," ",a.createElement("a",{target:"_blank",href:t},"here"),". Click"," ",a.createElement("a",{target:"_blank",href:"https://docs.google.com/forms/d/1F2mB10japkHAPb3H-9Q4YrYH0i61GoMG1tk-P4ZT808/edit"},"here")," ","to get edit access."))))}},39700:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return d},default:function(){return k},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return u}});var a=n(87462),o=n(63366),i=(n(67294),n(3905)),r=n(57723),l=["components"],s={id:"lesson",title:"MongoDB - 2",sidebar_label:"Lesson"},d=void 0,p={unversionedId:"mongodb/week-2/lesson",id:"mongodb/week-2/lesson",title:"MongoDB - 2",description:"Outline:",source:"@site/docs/mongodb/week-2/lesson.md",sourceDirName:"mongodb/week-2",slug:"/mongodb/week-2/lesson",permalink:"/mongodb/week-2/lesson",draft:!1,editUrl:"https://github.com/CodeYourFuture/Syllabus-V2/edit/master/docs/mongodb/week-2/lesson.md",tags:[],version:"current",frontMatter:{id:"lesson",title:"MongoDB - 2",sidebar_label:"Lesson"},sidebar:"MongoDB",previous:{title:"Instructor Notes",permalink:"/mongodb/week-1/instructors"},next:{title:"Coursework",permalink:"/mongodb/week-2/homework"}},c={},u=[{value:"Outline:",id:"outline",level:2},{value:"Review",id:"review",level:2},{value:"Signing up for MongoDB Atlas",id:"signing-up-for-mongodb-atlas",level:2},{value:"Making a local Express server",id:"making-a-local-express-server",level:2},{value:"Connecting to a MongoDB server from a local Node server",id:"connecting-to-a-mongodb-server-from-a-local-node-server",level:2},{value:"Creating and dropping databases and collections in Atlas",id:"creating-and-dropping-databases-and-collections-in-atlas",level:2},{value:"Reading documentation",id:"reading-documentation",level:2},{value:"BSON Types",id:"bson-types",level:2},{value:"Creating documents",id:"creating-documents",level:2},{value:"Creating a document in Atlas",id:"creating-a-document-in-atlas",level:3},{value:"Exercise 1",id:"exercise-1",level:4},{value:"Creating a document with the MongoDB Node Driver",id:"creating-a-document-with-the-mongodb-node-driver",level:3},{value:"Exercise 2",id:"exercise-2",level:4},{value:"Updating a document",id:"updating-a-document",level:2},{value:"Updating a document - investigating findOneAndUpdate&#39;s <code>result</code> in the documentation",id:"updating-a-document---investigating-findoneandupdates-result-in-the-documentation",level:4},{value:"Updating a document - back to the code...",id:"updating-a-document---back-to-the-code",level:4},{value:"Exercise 3",id:"exercise-3",level:4},{value:"Deleting a document",id:"deleting-a-document",level:2},{value:"Exercise 4",id:"exercise-4",level:4},{value:"Feedback",id:"feedback",level:2}],m={toc:u},h="wrapper";function k(e){var t=e.components,n=(0,o.Z)(e,l);return(0,i.kt)(h,(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"outline"},"Outline:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Review"),(0,i.kt)("li",{parentName:"ul"},"Signing up for MongoDB Atlas"),(0,i.kt)("li",{parentName:"ul"},"Making a local Express server"),(0,i.kt)("li",{parentName:"ul"},"Connecting to a MongoDB server from a local Node server"),(0,i.kt)("li",{parentName:"ul"},"Creating and dropping databases and collections in Atlas"),(0,i.kt)("li",{parentName:"ul"},"Reading documentation"),(0,i.kt)("li",{parentName:"ul"},"BSON types"),(0,i.kt)("li",{parentName:"ul"},"Creating documents"),(0,i.kt)("li",{parentName:"ul"},"Creating a document in Atlas"),(0,i.kt)("li",{parentName:"ul"},"Creating a document with the MongoDB Node Driver"),(0,i.kt)("li",{parentName:"ul"},"Updating a document"),(0,i.kt)("li",{parentName:"ul"},"Deleting a document")),(0,i.kt)("h2",{id:"review"},"Review"),(0,i.kt)("p",null,"In the last lesson, we learned"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"what a database is,"),(0,i.kt)("li",{parentName:"ul"},"what a DBMS is,"),(0,i.kt)("li",{parentName:"ul"},"what MongoDB is,"),(0,i.kt)("li",{parentName:"ul"},"what a callback function is,"),(0,i.kt)("li",{parentName:"ul"},"how to connect to a MongoDB server from a Node server,"),(0,i.kt)("li",{parentName:"ul"},"how to get all documents in a collection,"),(0,i.kt)("li",{parentName:"ul"},"how to search for documents in a collection, and"),(0,i.kt)("li",{parentName:"ul"},"how to get a single document in a collection using its ID.")),(0,i.kt)("p",null,"Now that we know how to read databases, collections, and documents, let's learn how to create, update, and delete them."),(0,i.kt)("h2",{id:"signing-up-for-mongodb-atlas"},"Signing up for MongoDB Atlas"),(0,i.kt)("p",null,"MongoDB Atlas is an online service for hosting a MongoDB database server. Luckily, there is a free version for simple projects like ours. Let's sign up for an account so we can create our own database."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Go to the\xa0",(0,i.kt)("a",{parentName:"li",href:"https://www.mongodb.com/cloud/atlas"},"MongoDB Atlas website"),"."),(0,i.kt)("li",{parentName:"ol"},'Click the "Try Free" button at the top of the page.'),(0,i.kt)("li",{parentName:"ol"},'Enter your email address, your name, and a new password, then agree to the terms and click "Get started free".'),(0,i.kt)("li",{parentName:"ol"},'When you see a popup, click the "Build my first cluster" button. It might ask you some questions and give you some tips, but you can skip those.'),(0,i.kt)("li",{parentName:"ol"},'Click the "Create Cluster" button at the bottom of the page.')),(0,i.kt)("p",null,'This actually creates a group of servers called a "cluster". However, it might take a few minutes for the cluster to be ready. While it is being prepared, let\'s make an Express server to connect to one of the servers in the cluster.'),(0,i.kt)("h2",{id:"making-a-local-express-server"},"Making a local Express server"),(0,i.kt)("p",null,'In the last lesson, we made an Express server on Glitch. In this lesson, however, we will make one on our own computer -- in other words, we will make a "local" server.'),(0,i.kt)("p",null,"Running a local server is the way most professional developers work, so it is important for you to learn."),(0,i.kt)("p",null,"Follow ",(0,i.kt)("a",{parentName:"p",href:"https://expressjs.com/en/starter/installing.html"},"these instructions for making a node app and installing Express.js"),'. When prompted, set the "entry point" to be ',(0,i.kt)("inlineCode",{parentName:"p"},"server.js"),". If you miss the chance, you can edit ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," to fix this."),(0,i.kt)("p",null,"Now that we have Express ready, let's start writing our JavaScript. Open your favourite code editor (for example, Visual Studio Code) and create a new file with this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'const express = require("express");\n\nconst app = express();\napp.use(express.json());\n\napp.get("/", function (request, response) {\n  response.send("Hello, world!");\n});\n\napp.listen(3000);\n')),(0,i.kt)("p",null,"Save this as\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"server.js"),"\xa0in your project directory."),(0,i.kt)("p",null,'The code should look a bit familiar from previous lessons. It imports Express, creates a new Express app, tells Express to return "Hello, world!" when you go to the\xa0',(0,i.kt)("inlineCode",{parentName:"p"},"/"),"\xa0endpoint, and starts listening for requests on port 3000."),(0,i.kt)("p",null,"Let's run it. Back in your shell, enter this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"node server.js\n\n")),(0,i.kt)("p",null,"This starts the Node server that we wrote in\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"server.js"),". When you run a server on your computer, you can usually get to it by going to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"localhost"),"\xa0in your browser. However, because we told it to listen to port 3000, we need to go to\xa0",(0,i.kt)("a",{parentName:"p",href:"http://localhost:3000/"},(0,i.kt)("inlineCode",{parentName:"a"},"localhost:3000")),'. When you go here in your browser, you should see "Hello, world!"'),(0,i.kt)("h2",{id:"connecting-to-a-mongodb-server-from-a-local-node-server"},"Connecting to a MongoDB server from a local Node server"),(0,i.kt)("p",null,"We now have a working Node server that uses the Express package. Let's connect it to a server in our new MongoDB cluster."),(0,i.kt)("p",null,"Add the MongoDB Node Driver package to your project. To do this, stop your server by pressing\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"ctrl+c"),", and run this in the terminal:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"npm install mongodb\n\n")),(0,i.kt)("p",null,'To use the driver to connect to our MongoDB server, we need to finish some more tasks on Atlas. Go back to the Atlas website in your browser, and you should see a "CONNECT" button. Click that, and you should see a new window with two steps: (1) whitelisting IP addresses and (2) creating a MongoDB user.'),(0,i.kt)("p",null,"In step 1, click a button to add a new IP address. A form should appear. Use the IP address\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"0.0.0.0"),", which lets you use the database anywhere, and click the button to add it."),(0,i.kt)("p",null,"In step 2, enter a new username (for example,\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"cyf"),") and new password that you will not forget (for example,\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"LetsLearnMongoDB2019"),'). You will put these in your code, so if you want people to look at your code, do not use a password you use somewhere else! Click the button to create the user, and then click the "Choose a connection method" button.'),(0,i.kt)("p",null,'You should now see three options. Click the second option: "Connect Your Application". This should show you a database URI that you can use to connect to a server in your MongoDB cluster.'),(0,i.kt)("p",null,"Note: you only need to use the part of the URI up to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"mongodb.net"),"\xa0(not the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"/test?..."),"\xa0part)."),(0,i.kt)("p",null,"Now, let's write some code. Open your\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"server.js"),"\xa0file again, and add a new line at the top to import the MongoDB driver:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'const mongodb = require("mongodb");\n')),(0,i.kt)("p",null,"Also add a line before your endpoints to define the database URI from Atlas, without the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"/test?..."),"\xa0part:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'const uri = "mongodb+srv://xxxx:xxxx@cluster0-xxxx.mongodb.net";\n')),(0,i.kt)("p",null,"Make sure that you use the real username, password, and address in this string. In the previous lesson, we were using public code on Glitch, so we put this in an environment variable. However, because this is local code and not public, we can put the password in the code for now."),(0,i.kt)("p",null,"Warning: do not put this code on Glitch or in a Git repository! If you do that, your password will become public, and then anyone can edit your database! (If you really want to make the code public, look into using environment variables.)"),(0,i.kt)("p",null,"With the URI, we can now connect to a database. Let's do that in the endpoint callback function:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'app.get("/", function (request, response) {\n  const client = new mongodb.MongoClient(uri);\n\n  client.connect(function () {\n    response.send("It worked!");\n    client.close();\n  });\n});\n')),(0,i.kt)("p",null,"Let's try to run this. Back in the shell, if you are still running your Node server, stop it by pressing\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"ctrl+c"),". You need to run it again to run your new code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"node server.js\n\n")),(0,i.kt)("p",null,"Once you run this, try reloading\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"localhost:3000"),'\xa0in your browser, and you should see "It worked!"'),(0,i.kt)("h2",{id:"creating-and-dropping-databases-and-collections-in-atlas"},"Creating and dropping databases and collections in Atlas"),(0,i.kt)("p",null,"To make our Express server useful, we need some data in our database. Let's learn how to add a database and a collection."),(0,i.kt)("p",null,'To add a database, click the "COLLECTIONS" button on Atlas. Let\'s add our own data, so click the "Add my own data" button.'),(0,i.kt)("p",null,"Now, you can enter the names of your first database and collection. Enter whatever you want, but you cannot use spaces or some special characters. Then click the Create button."),(0,i.kt)("p",null,"After that, you should see your collection (but it does not have any documents yet)."),(0,i.kt)("p",null,"If you ever want to delete a collection, hover over the the name of the collection in the database list, and click the rubbish bin icon to the right. A modal appears, and you just need to type in the name of the collection and click the Drop button to confirm."),(0,i.kt)("p",null,"When you drop a collection, if your database has nothing in it, the database will just disappear."),(0,i.kt)("p",null,"If you want to drop a whole database and all its collections and documents at the same time, just follow the same steps for the database: click the rubbish bin next to it, enter the name, and click the Drop button."),(0,i.kt)("p",null,"Now that we can create collections, we can create some documents. However, before we do that, let's look at a great way to help us understand the details."),(0,i.kt)("h2",{id:"reading-documentation"},"Reading documentation"),(0,i.kt)("p",null,'When you use tech like Node, Express, or MongoDB, you can usually find official notes online that tell you details about how to use it. These are called the "',(0,i.kt)("strong",{parentName:"p"},"documentation"),'" or "docs". Usually, you can find them on the official website.'),(0,i.kt)("p",null,"For MongoDB, you can find the documentation at\xa0",(0,i.kt)("a",{parentName:"p",href:"https://docs.mongodb.com/"},(0,i.kt)("inlineCode",{parentName:"a"},"docs.mongodb.com")),". Let's see what it has."),(0,i.kt)("p",null,"If you go to the MongoDB docs, you can find basic introductions like Getting Started and deeper explanations like the MongoDB Manual. If you want to search for something specific, you can use the search field at the top of the page."),(0,i.kt)("p",null,'Warning: be careful when reading code in the MongoDB docs, because it is usually not for the MongoDB Node Driver! Typically, when you see code, it will be for what is called the "Mongo Shell", which is another way to access a database. It looks similar to the kind of code we have been writing, but if you use it on a Node server, you might get confusing errors.'),(0,i.kt)("p",null,'Let\'s find the docs just for the MongoDB Node Driver. On the left side bar, click "MongoDB Drivers". This takes you to a page with drivers for different coding languages. Click "Node.js", which will take you to the MongoDB Node Driver page. A very helpful link here is "Usage Guide".'),(0,i.kt)("p",null,'Another very helpful link is "API Reference". Open this in a new tab. We will come back to it later.'),(0,i.kt)("p",null,"In the next section, we will learn about\xa0",(0,i.kt)("strong",{parentName:"p"},"BSON"),', the JSON-like format used for MongoDB documents. Before we start, click the "Server" tab at the top of the page, try searching for "BSON" in the docs, and then open the BSON Types page.'),(0,i.kt)("h2",{id:"bson-types"},"BSON Types"),(0,i.kt)("p",null,"Many coding languages have a list of data types. For example, in JavaScript, there is"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Number,"),(0,i.kt)("li",{parentName:"ul"},"String,"),(0,i.kt)("li",{parentName:"ul"},"Boolean (",(0,i.kt)("inlineCode",{parentName:"li"},"true"),"\xa0or\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"false"),"),"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"null"),","),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"undefined"),", and"),(0,i.kt)("li",{parentName:"ul"},"Object.")),(0,i.kt)("p",null,'In BSON (which stands for "Binary JSON"), the data types are different and a bit more complicated. Here are some of them:'),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"32-bit integer -- for whole numbers with no decimal points (examples:\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"0"),",\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"1"),",\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"183941"),",\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"-42"),")"),(0,i.kt)("li",{parentName:"ul"},"Double -- for number with decimal points (examples:\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"0.1"),",\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"1.0"),",\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"-31.39585"),")"),(0,i.kt)("li",{parentName:"ul"},"String"),(0,i.kt)("li",{parentName:"ul"},"Boolean"),(0,i.kt)("li",{parentName:"ul"},"Null"),(0,i.kt)("li",{parentName:"ul"},"Object"),(0,i.kt)("li",{parentName:"ul"},"Array"),(0,i.kt)("li",{parentName:"ul"},"ObjectId --\xa0the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"ObjectId"),"s you learned about in the last lesson"),(0,i.kt)("li",{parentName:"ul"},"Date --\xa0like JavaScript\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"Date"),"s")),(0,i.kt)("p",null,"You can find all of them and more information about them on that MongoDB docs page."),(0,i.kt)("p",null,"We will use some of these BSON types when we create our first documents."),(0,i.kt)("h2",{id:"creating-documents"},"Creating documents"),(0,i.kt)("p",null,"Let's learn a couple of ways to create MongoDB documents."),(0,i.kt)("h3",{id:"creating-a-document-in-atlas"},"Creating a document in Atlas"),(0,i.kt)("p",null,"Now, we are finally ready to make our first database documents! Let's open Atlas again and create a new database:\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"cinema"),". Let's also create a new collection called\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"films"),"."),(0,i.kt)("p",null,'To create a document in Atlas, click the "INSERT DOCUMENT" button on the right side of the page. A popup will appear with an\xa0',(0,i.kt)("inlineCode",{parentName:"p"},"ObjectId"),"\xa0already made for us. Now, we can add the rest of the fields."),(0,i.kt)("p",null,"To start, let's add a field called\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"title"),"\xa0for our film names. To the right of the field, you can see that there is already a data type selected: String. This is perfect for a title, so let's just type the name of a film as the field value. Use one of your favourite films! Then, press Enter."),(0,i.kt)("p",null,"Let's try another field with another data type. Add a field named\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"year"),', and select the type "Int32" (for 32-bit integer) so we can add numbers without decimal points. As the value, put the year the film was released. (Don\'t know the year? Use\xa0',(0,i.kt)("a",{parentName:"p",href:"https://imdb.com/"},"IMDb"),"\xa0to find out.)"),(0,i.kt)("p",null,"Now, let's try adding a new data type: Array. Select Array from the drop-down list, and give it the name\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"actors"),". You should see the index\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"0"),"\xa0appear below it. Here, you can enter the name of an actor in the film. When you press Enter, you can add even more."),(0,i.kt)("p",null,"When you have entered a few actors, click the Insert button to add the document. Now, you can see it inside of your collection."),(0,i.kt)("p",null,"That is how you can add a document easily with MongoDB Atlas."),(0,i.kt)("h4",{id:"exercise-1"},"Exercise 1"),(0,i.kt)("admonition",{title:"Exercise",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Try adding two new films to your database, using the Atlas web interface. Give each of them a title, year, and a few actors.")),(0,i.kt)("h3",{id:"creating-a-document-with-the-mongodb-node-driver"},"Creating a document with the MongoDB Node Driver"),(0,i.kt)("p",null,"When you build an app, you might also want to add documents from your server. This is how you can add a single document:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const doc = {\n  // ...\n};\n\ncollection.insertOne(doc, function (error, result) {\n  // ...\n});\n")),(0,i.kt)("p",null,"Here, you can just make a normal object that will convert to JSON, and MongoDB will automatically convert the data types to BSON. Also, if you do not include the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"_id"),"\xa0field, MongoDB will automatically add one for you."),(0,i.kt)("p",null,"Notice that the callback function for\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"insertOne"),"\xa0has a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"result"),"\xa0argument. This is an object that has some useful information about what you inserted into the collection. One useful property is\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"result.ops"),", which is an array with all the documents you just created, including the automatic\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"_id"),"."),(0,i.kt)("p",null,"Let's try adding an endpoint for creating a film to our code. Open up your code editor again, and add this new endpoint:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'app.post("/films", function (request, response) {\n  const client = new mongodb.MongoClient(uri);\n\n  client.connect(function () {\n    const db = client.db("cinema");\n    const collection = db.collection("films");\n\n    const film = {\n      title: "Princess Mononoke",\n      year: 1997,\n      actors: ["Billy Crudup", "Billy Bob Thorton", "Claire Danes"],\n    };\n\n    collection.insertOne(film, function (error, result) {\n      response.send(error || result.ops[0]);\n      client.close();\n    });\n  });\n});\n')),(0,i.kt)("p",null,"Here, when the user sends a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"POST"),"\xa0request to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"/films"),', the server creates a new film document with the title "Princess Mononoke" and responds with the inserted document, including the new\xa0',(0,i.kt)("inlineCode",{parentName:"p"},"_id"),"\xa0field."),(0,i.kt)("p",null,"To try it, restart your server first: go to your terminal shell, press\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"ctrl+c"),"\xa0to stop the server, press the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"up"),"\xa0key to go to your previous command, and then press\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"enter"),". Now, try sending a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"POST"),"\xa0request to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"localhost:3000/films"),"\xa0with Postman, and then check your collection on Atlas."),(0,i.kt)("h4",{id:"exercise-2"},"Exercise 2"),(0,i.kt)("admonition",{title:"Exercise",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Update the new endpoint to take query parameters\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"title"),",\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"year"),", and\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"actors"),"\xa0and create and return a new film with those fields and values. Make sure that only those fields are added. If a query parameter is missing, return a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"400"),"\xa0error. Make sure that the year is a number in the database (not a string). Let the actors be separated by commas."),(0,i.kt)("p",{parentName:"admonition"},"For example, sending a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"POST"),"\xa0request to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"/films?title=Ex Machina&year=2014&actors=Domhnall Gleeson,Oscar Isaac,Alicia Vikander"),"\xa0should create a new film document in the database like this:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "_id": "5d057f95243295255b98b6a0",\n  "title": "Ex Machina",\n  "year": 2014,\n  "actors": ["Domhnall Gleeson", "Oscar Isaac", "Alicia Vikander"]\n}\n\n')),(0,i.kt)("p",{parentName:"admonition"},"(Hint: you can turn a string like\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"a,b,c"),"\xa0into an array like\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"['a', 'b', 'c']"),"\xa0with\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"'a,b,c'.split(',')"),".)")),(0,i.kt)("h2",{id:"updating-a-document"},"Updating a document"),(0,i.kt)("p",null,"To update a single document, you can use\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"findOneAndUpdate"),"\xa0with a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"$set"),"\xa0operator like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const searchObject = {\n  // ...\n};\n\nconst updateObject = {\n  $set: {\n    // ...\n  },\n};\n\nconst options = {\n  // ...\n};\n\ncollection.findOneAndUpdate(\n  searchObject,\n  updateObject,\n  options,\n  function (error, result) {\n    // ...\n  }\n);\n")),(0,i.kt)("p",null,"This will update the first document that matches\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"searchObject"),"\xa0with the fields in\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"updateObject"),"\xa0using some\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"options"),"."),(0,i.kt)("p",null,"There are several options you can use. The one that we will use in this lesson is\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"returnOriginal"),". If your options include\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"returnOriginal: false"),", then you can get the updated document (not the original one) from\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"result"),"."),(0,i.kt)("p",null,"However,\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"result"),"\xa0here is different than the one for\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"insertOne"),". Let's investigate."),(0,i.kt)("h4",{id:"updating-a-document---investigating-findoneandupdates-result-in-the-documentation"},"Updating a document - investigating findOneAndUpdate's ",(0,i.kt)("inlineCode",{parentName:"h4"},"result")," in the documentation"),(0,i.kt)("p",null,"To see what this is, let's go to the\xa0",(0,i.kt)("a",{parentName:"p",href:"https://mongodb.github.io/node-mongodb-native/3.5/api/"},"API Reference"),"\xa0tab we opened earlier."),(0,i.kt)("p",null,"On this page, on the left side bar, we can see many objects we can use from the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"mongodb"),"\xa0package. We want to find information about the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"findOneAndUpdate"),"\xa0function, which is on a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"Collection"),', so let\'s click the "Collection" link. This opens many properties that a\xa0',(0,i.kt)("inlineCode",{parentName:"p"},"Collection"),"\xa0has, including its methods (functions). Find and click the link for\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"findOneAndUpdate"),"."),(0,i.kt)("p",null,"Here, we can see description of the function and its arguments. For example, you can see a list of options we can use. We can also see a column with the arguments types. We want to see what we can do with the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"result"),"\xa0argument of the callback function, so click the type for\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"callback"),': "',(0,i.kt)("a",{parentName:"p",href:"https://mongodb.github.io/node-mongodb-native/3.5/api/Collection.html#~findAndModifyCallback"},"Collection~findAndModifyCallback"),'".'),(0,i.kt)("p",null,"Now, we can see the description of what our callback function and its arguments should be. Click on the type of\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"result"),'\xa0so we can find out more about it: "',(0,i.kt)("a",{parentName:"p",href:"https://mongodb.github.io/node-mongodb-native/3.5/api/Collection.html#~findAndModifyWriteOpResult"},"Collection~findAndModifyWriteOpResult"),'".'),(0,i.kt)("p",null,"Finally, we can see the properties of\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"result"),". Notice the first property,\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"value"),", which will be our updated document. We can use this to return the updated document to the user."),(0,i.kt)("p",null,"Note: at the time of writing this lesson, the docs have some problems. For example, the description of the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"value"),"\xa0property says that it is from the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"findAndModify"),"\xa0command, but it is really from the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"findAndUpdateOne"),"\xa0command for us. Mistakes like these are not uncommon in documentation. (If you are stuck on something, and docs do not help, a good place to ask for help is\xa0",(0,i.kt)("a",{parentName:"p",href:"https://stackoverflow.com/"},"Stack Overflow"),".)"),(0,i.kt)("h4",{id:"updating-a-document---back-to-the-code"},"Updating a document - back to the code..."),(0,i.kt)("p",null,"Now, we know how to use\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"result"),". For example, we can do this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'const searchObject = { title: "Princess Mononoke" };\n\nconst updateObject = {\n  $set: {\n    year: 2000,\n  },\n};\n\nconst options = { returnOriginal: false };\n\ncollection.findOneAndUpdate(\n  searchObject,\n  updateObject,\n  options,\n  function (error, result) {\n    response.send(error || result.value);\n    client.close();\n  }\n);\n')),(0,i.kt)("p",null,'Here, we make a search object for a film whose title is "Princess Mononoke". We also make an update object to set the film\'s year to 2000. We also set some options to include the updated film in\xa0',(0,i.kt)("inlineCode",{parentName:"p"},"result"),"\xa0(not the original film, whose\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"year"),"\xa0was\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"1997"),"). We then pass these to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"collection.findOneAndUpdate"),"\xa0with a callback function. After the Node Driver finds the first film with that matches the search object and updates it with the update object, it runs the callback function, which responds with the new film document (or an error) and closes the client."),(0,i.kt)("p",null,"Let's try it in our code. Add a new endpoint like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'app.put("/films", function (request, response) {\n  const client = new mongodb.MongoClient(uri);\n\n  client.connect(function () {\n    const db = client.db("cinema");\n    const collection = db.collection("films");\n\n    const searchObject = { title: "Princess Mononoke" };\n\n    const updateObject = {\n      $set: {\n        year: 2000,\n      },\n    };\n\n    const options = { returnOriginal: false };\n\n    collection.findOneAndUpdate(\n      searchObject,\n      updateObject,\n      options,\n      function (error, result) {\n        response.send(error || result.value);\n        client.close();\n      }\n    );\n  });\n});\n')),(0,i.kt)("p",null,"Now, when we make a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"PUT"),"\xa0request to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"/films"),", the server changes the year of Princess Mononoke to 2000, and it returns the film."),(0,i.kt)("p",null,"To try it, restart your server again (in the terminal:\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"ctrl+c"),",\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"up"),",\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"enter"),") and make a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"PUT"),"\xa0request to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"localhost:3000/films"),"\xa0in Postman."),(0,i.kt)("h4",{id:"exercise-3"},"Exercise 3"),(0,i.kt)("admonition",{title:"Exercise",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Change the new endpoint to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"/films/:id"),", and make it take a JSON object body and replace the document that has that\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"id"),"."),(0,i.kt)("p",{parentName:"admonition"},"If the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"id"),"\xa0is not a valid\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"ObjectId"),"\xa0string, return a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"400"),"\xa0status code."),(0,i.kt)("p",{parentName:"admonition"},"Allow only the properties\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"_id"),",\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"title"),",\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"year"),", and\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"actors"),". Do not allow objects with missing properties. Only allow the correct data type for each property. Do not allow the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"_id"),"\xa0to be changed. If the JSON body is not allowed, return a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"422"),"\xa0status code."),(0,i.kt)("p",{parentName:"admonition"},"If no film has that\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"id"),", return a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"404"),"\xa0status code."),(0,i.kt)("p",{parentName:"admonition"},"If the update is successful, return the updated document."),(0,i.kt)("p",{parentName:"admonition"},"For example, if there is a film with\xa0",(0,i.kt)("inlineCode",{parentName:"p"},'_id: ObjectId("5d057f95243295255b98b6a0")'),", then sending a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"PUT"),"\xa0request to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"/films/5d057f95243295255b98b6a0"),"\xa0should update that film with the JSON body."),(0,i.kt)("p",{parentName:"admonition"},"Hint: use this function to check if the request body is allowed."),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-js"},'/** Given `request.params` and `request.body`, check if the `PUT` request body is allowed. */\nfunction getPutBodyIsAllowed(requestParams, requestBody) {\n  const fieldNames = Object.keys(requestBody);\n  const allowedFieldNames = ["_id", "title", "year", "actors"];\n\n  return (\n    fieldNames.length === allowedFieldNames.length &&\n    fieldNames.every((name) => allowedFieldNames.includes(name)) &&\n    requestParams.id === requestBody._id &&\n    typeof requestBody.title === "string" &&\n    typeof requestBody.year === "number" &&\n    Array.isArray(requestBody.actors) &&\n    requestBody.actors.every((actor) => typeof actor === "string")\n  );\n}\n'))),(0,i.kt)("h2",{id:"deleting-a-document"},"Deleting a document"),(0,i.kt)("p",null,"To delete a single document, you can use\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"collection.deleteOne"),"\xa0like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const searchObject = {\n  // ...\n};\n\ncollection.deleteOne(searchObject, function (error, result) {\n  // ...\n});\n")),(0,i.kt)("p",null,"This will delete the first object that matches the fields in\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"searchObject"),"."),(0,i.kt)("p",null,"Here,\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"result"),"\xa0is also different than before. One property we will use is\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"result.deletedCount"),", which should be\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"1"),"\xa0if a document was deleted."),(0,i.kt)("p",null,"Question: what status code should we give if we delete something successfully? When we call\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"response.send()"),", the code will be\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"200"),"\xa0by default. However,\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"200"),"\xa0actually means that the response will should have some data. When we delete a film, though, we are removing the data for that film, so we do not need to return it. The status code for success but no data is\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"204"),". (You can learn more about HTTP status codes\xa0",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes"},"here"),".)"),(0,i.kt)("p",null,"Let's see an example of\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"deleteOne"),"\xa0and a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"204"),"\xa0response:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'const searchObject = { title: "Princess Mononoke" };\n\ncollection.deleteOne(searchObject, function (error, result) {\n  if (error) {\n    response.status(500).send(error);\n  } else if (result.deletedCount) {\n    response.sendStatus(204);\n  } else {\n    response.sendStatus(404);\n  }\n});\n')),(0,i.kt)("p",null,'This tries to delete the first document with the title "Princess Mononoke". If an error happens, it returns a\xa0',(0,i.kt)("inlineCode",{parentName:"p"},"500"),"\xa0status code and the error in the response body. Otherwise, if something was deleted, it returns an empty\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"204"),"\xa0response. If something was\xa0",(0,i.kt)("em",{parentName:"p"},"not"),"\xa0deleted, that means that MongoDB could not find any match, so it returns an empty\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"404"),"\xa0response."),(0,i.kt)("p",null,"Let's put this in a new endpoint of our code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'app.delete("/films/:title", function (request, response) {\n  const client = new mongodb.MongoClient(uri);\n\n  client.connect(function () {\n    const db = client.db("cinema");\n    const collection = db.collection("films");\n\n    const searchObject = { title: request.params.title };\n\n    collection.deleteOne(searchObject, function (error, result) {\n      if (error) {\n        response.status(500).send(error);\n      } else if (result.deletedCount) {\n        response.sendStatus(204);\n      } else {\n        response.sendStatus(404);\n      }\n\n      client.close();\n    });\n  });\n});\n')),(0,i.kt)("p",null,"When a user sends a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"DELETE"),"\xa0request to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"/films/Princess Mononoke"),', for example, it should either (1) delete the first film called "Princess Mononoke" if it exists and return\xa0',(0,i.kt)("inlineCode",{parentName:"p"},"204"),"\xa0(2) just return\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"404"),"\xa0if it does not exist."),(0,i.kt)("p",null,"To try it, restart your server, find a film title in your database, and send a\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"DELETE"),"\xa0request to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"/films/<put the film title here>"),"\xa0in Postman."),(0,i.kt)("h4",{id:"exercise-4"},"Exercise 4"),(0,i.kt)("admonition",{title:"Exercise",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Change the new endpoint to\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"/films/:id"),". Make it delete only the object with the given\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"id"),".")),(0,i.kt)("h2",{id:"feedback"},"Feedback"),(0,i.kt)("p",null,"Please spend two minutes reviewing this lesson to help us improve it for the future. This feedback will be shared with volunteers."),(0,i.kt)(r.Z,{module:"MongoDB",week:"Week 2",mdxType:"Feedback"}))}k.isMDXComponent=!0}}]);