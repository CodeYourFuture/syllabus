"use strict";(self.webpackChunkcodeyourfuture_syllabus=self.webpackChunkcodeyourfuture_syllabus||[]).push([[1708],{3905:function(e,t,a){a.d(t,{Zo:function(){return m},kt:function(){return p}});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var i=n.createContext({}),u=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},m=function(e){var t=u(e.components);return n.createElement(i.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=u(a),p=o,h=c["".concat(i,".").concat(p)]||c[p]||d[p]||r;return a?n.createElement(h,l(l({ref:t},m),{},{components:a})):n.createElement(h,l({ref:t},m))}));function p(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,l=new Array(r);l[0]=c;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:o,l[1]=s;for(var u=2;u<r;u++)l[u]=a[u];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},64729:function(e,t,a){a.r(t),a.d(t,{assets:function(){return m},contentTitle:function(){return i},default:function(){return p},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return d}});var n=a(87462),o=a(63366),r=(a(67294),a(3905)),l=["components"],s={},i="Database 1: Introduction to SQL",u={unversionedId:"db/week-1/lesson",id:"db/week-1/lesson",title:"Database 1: Introduction to SQL",description:"---",source:"@site/docs/db/week-1/lesson.md",sourceDirName:"db/week-1",slug:"/db/week-1/lesson",permalink:"/db/week-1/lesson",draft:!1,editUrl:"https://github.com/CodeYourFuture/Syllabus-V2/edit/master/docs/db/week-1/lesson.md",tags:[],version:"current",frontMatter:{},sidebar:"SQL",previous:{title:"prep",permalink:"/db/prep"},next:{title:"Mentor's Notes",permalink:"/db/week-1/instructors"}},m={},d=[{value:"What will we learn today?",id:"what-will-we-learn-today",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Introduction to databases",id:"introduction-to-databases",level:2},{value:"Why do we need them?",id:"why-do-we-need-them",level:3},{value:"Different types of database",id:"different-types-of-database",level:3},{value:"Introduction to PostgreSQL",id:"introduction-to-postgresql",level:2},{value:"What is SQL?",id:"what-is-sql",level:3},{value:"What is an RDBMS?",id:"what-is-an-rdbms",level:3},{value:"What characterizes a relational database?",id:"what-characterizes-a-relational-database",level:3},{value:"Communicating with the database using SQL",id:"communicating-with-the-database-using-sql",level:2},{value:"The SELECT Statement",id:"the-select-statement",level:2},{value:"Scrolling the Results",id:"scrolling-the-results",level:3},{value:"Exercise 1",id:"exercise-1",level:2},{value:"Some Useful <code>psql</code> Commands",id:"some-useful-psql-commands",level:2},{value:"Exercise 2",id:"exercise-2",level:2},{value:"Displaying More Than Just Columns",id:"displaying-more-than-just-columns",level:2},{value:"Expressions in SQL",id:"expressions-in-sql",level:2},{value:"Choosing the Rows",id:"choosing-the-rows",level:2},{value:"Combining Tests in a Predicate",id:"combining-tests-in-a-predicate",level:3},{value:"Overriding Evaluation Order",id:"overriding-evaluation-order",level:3},{value:"More Predicate Types",id:"more-predicate-types",level:2},{value:"Exercise 3",id:"exercise-3",level:2},{value:"Using SQL Functions",id:"using-sql-functions",level:3},{value:"Date and Time in SQL",id:"date-and-time-in-sql",level:3},{value:"Exercise 4",id:"exercise-4",level:2},{value:"Eliminating Duplicates",id:"eliminating-duplicates",level:2},{value:"Ordering the Returned Rows",id:"ordering-the-returned-rows",level:2},{value:"Limiting the Number of Rows",id:"limiting-the-number-of-rows",level:3},{value:"Exercise 5",id:"exercise-5",level:2},{value:"Summary",id:"summary",level:2},{value:"Homework",id:"homework",level:2},{value:"Submission",id:"submission",level:3},{value:"Tasks",id:"tasks",level:3}],c={toc:d};function p(e){var t=e.components,s=(0,o.Z)(e,l);return(0,r.kt)("wrapper",(0,n.Z)({},c,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"database-1-introduction-to-sql"},"Database 1: Introduction to SQL"),(0,r.kt)("hr",null),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Teaching this lesson?")),(0,r.kt)("p",null,"Read the Mentors Notes ",(0,r.kt)("a",{parentName:"p",href:"/db/week-1/instructors"},"here")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"what-will-we-learn-today"},"What will we learn today?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#introduction-to-databases"},"Introduction to databases"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Why do we need them?"),(0,r.kt)("li",{parentName:"ul"},"Different types of database"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#introduction-to-postgresql"},"Introduction to PostgreSQL"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"What is SQL?"),(0,r.kt)("li",{parentName:"ul"},"What is a RDBMS?"),(0,r.kt)("li",{parentName:"ul"},"What characterises a relational database?"),(0,r.kt)("li",{parentName:"ul"},"Check your PostgreSQL installation"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#communicating-with-the-database-using-sql"},"Communicating with the database using SQL"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Retrieving data from an existing database"),(0,r.kt)("li",{parentName:"ul"},"Use basic single table query commands in SQL"),(0,r.kt)("li",{parentName:"ul"},"Choose which values are returned by a query"),(0,r.kt)("li",{parentName:"ul"},"Use literals, expressions and functions in queries"),(0,r.kt)("li",{parentName:"ul"},"Restricting the rows returned by a query to match some condition"),(0,r.kt)("li",{parentName:"ul"},"Sorting and limiting the number of rows returned"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#homework"},"Homework"))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"learning-objectives"},"Learning Objectives"),(0,r.kt)("p",null,"By the end of this lesson students should be able to"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Explain why databases are needed in Web Development"),(0,r.kt)("li",{parentName:"ul"},"Define what SQL is and what it is used for"),(0,r.kt)("li",{parentName:"ul"},"Describe what ",(0,r.kt)("inlineCode",{parentName:"li"},"tables"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"rows")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"columns")," are used for in a relational database"),(0,r.kt)("li",{parentName:"ul"},"Retrieve data from a table using PostgreSQL"),(0,r.kt)("li",{parentName:"ul"},"Use expressions to manipulate the results of queries"),(0,r.kt)("li",{parentName:"ul"},"Retrieve data from a table using conditionals in PostgreSQL"),(0,r.kt)("li",{parentName:"ul"},"Insert new data into existing tables")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"introduction-to-databases"},"Introduction to databases"),(0,r.kt)("p",null,"A database is a structured set of data held in a computer. It provides ways to store, retrieve and organize information."),(0,r.kt)("h3",{id:"why-do-we-need-them"},"Why do we need them?"),(0,r.kt)("p",null,"In the past few weeks, you stored and retrieved data using files. This is fine for simple data but it can quickly become an issue as your application becomes more complex and needs to store and manipulate more complicated data. For example, imagine you are asked to develop a booking system for a medium-sized hotel. You will need to store the list of rooms available for booking, and as you add more features, you will need to save users information, the reviews they post, the bookings each user makes and payment information. You can see that the data you need to handle can become very complicated, especially when you need to consider that data are not static, as they can be updated or deleted. To work more effectively with data, we can then use a database, which presents the following benefits:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A database defines a structure for your data and the relationships between entities"),(0,r.kt)("li",{parentName:"ul"},"A database provides convenient and performant ways to safely store and retrieve data"),(0,r.kt)("li",{parentName:"ul"},"A database provides a mechanism to check the validity of your data")),(0,r.kt)("h3",{id:"different-types-of-database"},"Different types of database"),(0,r.kt)("p",null,"There are many different kinds of database and different implementations. Sometimes, a database type is a better fit to certain use case or certain problems. The most well-known database types include relational database, key/value database, graph database and document database (also known as NoSQL). For this class, we will focus specifically on relational database as they are the most widely used and supported. You can consult ",(0,r.kt)("a",{parentName:"p",href:"https://db-engines.com/en/ranking"},"DB-Engines")," to see a ranking of the most used database, as you can see, there are a lot of them!"),(0,r.kt)("h2",{id:"introduction-to-postgresql"},"Introduction to PostgreSQL"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},'"PostgreSQL is a powerful, open source object-relational database system that uses and extends the SQL language combined with many features that safely store and scale the most complicated data workloads. The origins of PostgreSQL date back to 1986 as part of the POSTGRES project at the University of California at Berkeley and has more than 30 years of active development on the core platform."')," (source: ",(0,r.kt)("a",{parentName:"p",href:"https://www.postgresql.org/about/"},"postgresql.org"),")"),(0,r.kt)("h3",{id:"what-is-sql"},"What is SQL?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Pronounced S-Q-L or sequel"),(0,r.kt)("li",{parentName:"ul"},"Stands for Structured Query Language"),(0,r.kt)("li",{parentName:"ul"},"SQL is the standard language used to communicate with relational database"),(0,r.kt)("li",{parentName:"ul"},"SQL statements are used to query, create, update, delete records in a database as well as many other tasks"),(0,r.kt)("li",{parentName:"ul"},"SQL statements are executed by a RDBMS.")),(0,r.kt)("h3",{id:"what-is-an-rdbms"},"What is an RDBMS?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Stands for Relational Database Management System"),(0,r.kt)("li",{parentName:"ul"},"It is a program that processes SQL statements to manage a relational database"),(0,r.kt)("li",{parentName:"ul"},"PostgreSQL is an RDBMS.")),(0,r.kt)("h3",{id:"what-characterizes-a-relational-database"},"What characterizes a relational database?"),(0,r.kt)("p",null,"As mentioned previously, a relational database is a specific type of database. Data is stored in ",(0,r.kt)("em",{parentName:"p"},"tables (relations)")," of ",(0,r.kt)("em",{parentName:"p"},"rows (tuples)")," and ",(0,r.kt)("em",{parentName:"p"},"columns (attributes)")," as per the example below:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"table-diagram",src:a(92568).Z,width:"530",height:"505"})),(0,r.kt)("h2",{id:"communicating-with-the-database-using-sql"},"Communicating with the database using SQL"),(0,r.kt)("p",null,"We use SQL to perform actions on the database and initially we can use a terminal-like utility to do this. The utility is named ",(0,r.kt)("inlineCode",{parentName:"p"},"psql")," and is run using the command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"psql <dbname> <username>\n")),(0,r.kt)("p",null,"The command prompt from psql is the database name currently connected:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cyf_hotel=>\n")),(0,r.kt)("p",null,"In psql, you can use the command ",(0,r.kt)("inlineCode",{parentName:"p"},"help")," to show the help menu. Within the command prompt, you can enter SQL statements and run them against PostgreSQL. To quit psql, enter the command ",(0,r.kt)("inlineCode",{parentName:"p"},"\\q"),"."),(0,r.kt)("p",null,"Download the following file to a directory on your computer. This file creates the sample data you can use for the following sections. To do this, click the file to open it in a github formatted page, then right click the Raw button in the bar just above the code and select Save As (or Save Link As or similar) to save it:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{target:"_blank",href:a(10433).Z},(0,r.kt)("code",null,"build-hotel.sql")))),(0,r.kt)("p",null,"Once you have the file downloaded to a known directory, execute the file ",(0,r.kt)("inlineCode",{parentName:"p"},"build-hotel.sql")," from ",(0,r.kt)("inlineCode",{parentName:"p"},"psql")," as shown below (replace ",(0,r.kt)("inlineCode",{parentName:"p"},"/your/sql/path/")," with the path to the download directory used above):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-SQL"},"\\include /your/sql/path/build-hotel.sql\n")),(0,r.kt)("p",null,"Check that you have built all the required tables:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"\\dt\n")),(0,r.kt)("p",null,"You should see a listing of your tables as follows (with your own username as owner):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"            List of relations\n    Schema |     Name      | Type  | Owner\n    --------+---------------+-------+-------\n    public | customers     | table | keith\n    public | invoices      | table | keith\n    public | reservations  | table | keith\n    public | room_types    | table | keith\n    public | rooms         | table | keith\n    (5 rows)\n")),(0,r.kt)("p",null,"Here is the table diagram of the hotel database:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"hotel table diagram",src:a(78011).Z,width:"794",height:"1123"})),(0,r.kt)("h2",{id:"the-select-statement"},"The SELECT Statement"),(0,r.kt)("p",null,"We are first going to look at retrieving data from the database so we can examine it and later, use it in our applications."),(0,r.kt)("p",null,"To get data out of a table you use the SELECT statement (or command):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT ... FROM ...;\n")),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT name, phone, country FROM customers;\n")),(0,r.kt)("p",null,"SQL commands entered in the psql command line tool are terminated with a semicolon (;). The SQL command can extend across several lines, but each keyword, name or value cannot be split over more than one line. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT name,\n       phone,\n       country\n  FROM\n       customers;\n")),(0,r.kt)("p",null,"is the same as the previous example."),(0,r.kt)("p",null,"You can use ",(0,r.kt)("inlineCode",{parentName:"p"},"SELECT * FROM ...")," to return all the columns of the table. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM rooms;\n")),(0,r.kt)("p",null,"This is also a useful command to see what columns exist in a table. You can also use the ",(0,r.kt)("inlineCode",{parentName:"p"},"\\d <table_name>")," psql command to describe the table."),(0,r.kt)("p",null,"Note that the use of UPPER/lower case is only to emphasise and differentiate the SQL keywords (upper case) from the other names (lower case) e.g. column and table names. SQL keywords are not case-sensitive."),(0,r.kt)("h3",{id:"scrolling-the-results"},"Scrolling the Results"),(0,r.kt)("p",null,"When you issue a ",(0,r.kt)("inlineCode",{parentName:"p"},"SELECT")," that returns a lot of data ",(0,r.kt)("inlineCode",{parentName:"p"},"psql")," displays it one screenful at a time. To get the next screenful just press the Space key. You can also use the Up and Down arrow keys for line-by-line control and you can go back one screen with the 'B' key."),(0,r.kt)("p",null,"When you have finished reading the output use the 'Q' key to quit the display manager."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    Space       Next screenful\n    'B'         Previous screenful\n    Down Arrow  Next line\n    Up Arrow    Previous line\n    'Q'         Quit back to prompt\n")),(0,r.kt)("h2",{id:"exercise-1"},"Exercise 1"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"List the name, phone and email of all customers"),(0,r.kt)("li",{parentName:"ol"},"List all the details of rooms"),(0,r.kt)("li",{parentName:"ol"},"List the customer id, checkin date and number of guests from reservations")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"some-useful-psql-commands"},"Some Useful ",(0,r.kt)("inlineCode",{parentName:"h2"},"psql")," Commands"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"psql")," commands are not SQL and are specific to PostgreSQL (although most other RDBMS's have commands to perform similar jobs). These commands let you display information, execute system commands, etc. Use ","\\","? to display a summary of all the ",(0,r.kt)("inlineCode",{parentName:"p"},"psql")," commands."),(0,r.kt)("p",null,"Display a list of available tables in the database:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\\dt\n")),(0,r.kt)("p",null,"Display the definition of a table:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\\d <table name>\n")),(0,r.kt)("p",null,"Display help for SQL commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\\h [command]\n")),(0,r.kt)("p",null,"Display a summary of the psql (backslash) commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\\?\n")),(0,r.kt)("p",null,"Exit (quit) from psql:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\\q\n")),(0,r.kt)("p",null,"Note that ",(0,r.kt)("inlineCode",{parentName:"p"},"psql")," commands ARE case sensitive, unlike SQL commands."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"exercise-2"},"Exercise 2"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Display the definition of the ",(0,r.kt)("inlineCode",{parentName:"li"},"customers")," table"),(0,r.kt)("li",{parentName:"ol"},"Display the help for the SELECT command (Note: we will not be covering ALL of this syntax!)"),(0,r.kt)("li",{parentName:"ol"},"Read the psql command help and find out what \\dS does then try it")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"displaying-more-than-just-columns"},"Displaying More Than Just Columns"),(0,r.kt)("p",null,"You can use expressions in SQL:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT room_no, rate * 0.85 FROM rooms;\n+---------+-------------+\n| room_no | rate * 0.85 |\n+---------+-------------+\n|     101 |     72.2500 |\n|     102 |     72.2500 |\n|     103 |     72.2500 |\n  ...\n")),(0,r.kt)("p",null,"Use a ",(0,r.kt)("strong",{parentName:"p"},"column alias")," to give the expression a meaningful name:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT room_no,\n       rate * 0.85 AS discounted_rate\n    FROM rooms;\n+---------+-----------------+\n| room_no | discounted_rate |\n+---------+-----------------+\n|     101 |         72.2500 |\n|     102 |         72.2500 |\n|     103 |         72.2500 |\n")),(0,r.kt)("p",null,"Here, the query uses the alias as the column heading. Aliases can also be used in other contexts - more on this later..."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"expressions-in-sql"},"Expressions in SQL"),(0,r.kt)("p",null,"As with Javascript you can use a variety of 'operators' to define expressions in SQL."),(0,r.kt)("p",null,"Arithmetic:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"*   Multiply\n\n/   Divide\n\n+   Add\n\n-   Subtract\n\n%   Modulo (remainder)\n\n(...) Parentheses (to override precedence)\n")),(0,r.kt)("p",null,"String:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"||  Concatenation\n")),(0,r.kt)("p",null,"For example, to display the weekly rate for a room (with 10% weekly discount):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT room_no, room_type, rate * 7 * 0.90 from rooms;\n")),(0,r.kt)("p",null,"You can change the column heading using a ",(0,r.kt)("strong",{parentName:"p"},"column alias"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT room_no, room_type, rate * 7 * 0.90 as weekly_rate from rooms;\n")),(0,r.kt)("p",null,"Use string concatenation to glue character data together:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT 'Customer name = ' || name FROM customers;\n")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"choosing-the-rows"},"Choosing the Rows"),(0,r.kt)("p",null,"You can choose which rows to display by specifying some condition that must be matched:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT id, name, phone, email, country\n  FROM customers\n  WHERE country = 'France';\n\n id  |        name        |      phone       |            email            | country\n-----+--------------------+------------------+-----------------------------+---------\n 9   | Laurence Lebihan   | 91.24.4555       | laurence.lebihan@xmzx.net   | France\n 12  | Carine Schmitt     | 40.32.2555       | carine.schmitt@dftu.net     | France\n 15  | Janine Labrune     | 40.67.8555       | janine.labrune@dlsh.net     | France\n 25  | Mary Saveley       | 78.32.5555       | mary.saveley@yppl.net       | France\n 34  | Martine Ranc\xe9      | 20.16.1555       | martine.ranc\xe9@xeqs.net      | France\n 35  | Marie Bertrand     | (1) 42.34.2555   | marie.bertrand@glut.net     | France\n 49  | Fr\xe9d\xe9rique Citeaux | 88.60.1555       | fr\xe9d\xe9rique.citeaux@vekn.net | France\n 59  | Annette Roulet     | 61.77.6555       | annette.roulet@lgha.net     | France\n 62  | Daniel Da Silva    | +33 1 46 62 7555 | daniel.da.silva@hijy.net    | France\n 63  | Daniel Tonini      | 30.59.8555       | daniel.tonini@mxvw.net      | France\n 91  | Laurence Lebihan   | 91.24.4555       | laurence.lebihan@xmzx.net   | France\n 92  | Paul Henriot       | 26.47.1555       | paul.henriot@uwua.net       | France\n 106 | Dominique Perrier  | (1) 47.55.6555   | dominique.perrier@bdim.net  | France\n(13 rows)\n")),(0,r.kt)("p",null,"You can use comparison operators ",(0,r.kt)("inlineCode",{parentName:"p"},"="),", ",(0,r.kt)("inlineCode",{parentName:"p"},"<"),", ",(0,r.kt)("inlineCode",{parentName:"p"},">"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"<="),", ",(0,r.kt)("inlineCode",{parentName:"p"},">="),", ",(0,r.kt)("inlineCode",{parentName:"p"},"!=")," (or ",(0,r.kt)("inlineCode",{parentName:"p"},"<>"),")"),(0,r.kt)("p",null,"Note: use only one = (equals) symbol to test for equality"),(0,r.kt)("p",null,"When comparing numbers no punctuation is needed around the value, for example, ",(0,r.kt)("inlineCode",{parentName:"p"},"WHERE rate > 100"),"."),(0,r.kt)("p",null,"When comparing character data or dates you must enclose the values in single quotes (apostrophes), for example, ",(0,r.kt)("inlineCode",{parentName:"p"},"WHERE name = 'Mary Saveley'"),"."),(0,r.kt)("p",null,"Only the rows that match the comparison test (called a predicate) are returned by the query. The predicate can use columns not returned by the query,"),(0,r.kt)("h3",{id:"combining-tests-in-a-predicate"},"Combining Tests in a Predicate"),(0,r.kt)("p",null,"Use AND and OR to combine tests:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM reservations\n   WHERE room_no >= 200\n     AND room_no < 300\n     AND checkin_date >= '2018-01-01';\n")),(0,r.kt)("p",null,"This lists reservations for rooms on the second floor (rooms 200 - 299) since the start of 2018. Note the format of the date value - this conforms to the ISO 8601 standard and should be used in preference to any other format to avoid ambiguity."),(0,r.kt)("p",null,"Another example - to find cheap or Premier rooms on floors 1 and 2 - we might try this to start with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM rooms\n   WHERE room_type = 'PREMIER'\n      OR rate < 100.00\n     AND room_no < 300;\n")),(0,r.kt)("p",null,"This isn't quite right - it returns rooms on the 3rd and 4th floors. Why?"),(0,r.kt)("h3",{id:"overriding-evaluation-order"},"Overriding Evaluation Order"),(0,r.kt)("p",null,"Just like any programming language, SQL has an evaluation order (precedence). For example, multiply and divide take precedence over add and subtract, so that:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT rate + 20 * 0.85 from rooms;\n")),(0,r.kt)("p",null,"is not the same as:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT (rate + 20) * 0.85 from rooms;\n")),(0,r.kt)("p",null,"We can override the normal precedence by using parentheses ",(0,r.kt)("inlineCode",{parentName:"p"},"(...)")," around parts of the expression, just as in JavaScript."),(0,r.kt)("p",null,"With compound predicates AND takes precedence over OR, so that to make the query give the intended results we need to use:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM rooms\n   WHERE (room_type = 'PREMIER'\n      OR rate < 100.00)\n     AND room_no < 300;\n")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"more-predicate-types"},"More Predicate Types"),(0,r.kt)("p",null,"The BETWEEN operator has the form ",(0,r.kt)("inlineCode",{parentName:"p"},"a BETWEEN b AND c")," : checks that a is in the range b - c inclusive. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT ... WHERE price BETWEEN 100 AND 250 ...\n")),(0,r.kt)("p",null,"Note that the AND in this case is not combining multiple predicates, it's part of the BETWEEN operator."),(0,r.kt)("p",null,"The IN operator, ",(0,r.kt)("inlineCode",{parentName:"p"},"a IN (b, c, d, ...)")," checks if the value of a is equal to any of b, c, d, etc... For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT ... WHERE room_no IN (201, 202, 204, 206) ...\n")),(0,r.kt)("p",null,"Both the BETWEEN and the IN operators can be inverted using:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"  ... a NOT BETWEEN b AND c ...\n\n  ... a NOT IN (b, c, d, ...)\n")),(0,r.kt)("p",null,"The LIKE operator tests for a match against a wildcard string as ",(0,r.kt)("inlineCode",{parentName:"p"},"a LIKE b")," where a is being tested and b is the wildcard string. The wildcard string contains text to be matched along with wildcard symbols '%' and '","_","'."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"%")," (percent) matches any number of any characters"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"_")," (underscore) matches exactly one of any character")),(0,r.kt)("p",null,"For example:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"name LIKE 'A%'")," matches names starting with 'A'"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"name LIKE '_a%'")," matches names that have 'a' as the 2nd character (note the initial underscore '","_","')"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"name LIKE '%ow%'")," matches names containing the sequence 'ow' anywhere in the name"),(0,r.kt)("p",null,"LIKE can be inverted using ",(0,r.kt)("inlineCode",{parentName:"p"},"a NOT LIKE b")),(0,r.kt)("p",null,"If you need to match for a string that includes one of the wildard characters you can use the 'escape' character, which defaults to '","\\","' (backslash). For example:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"str LIKE '% discount = 5\\% %'")," matches any value in str that contains 'discount = 5%'"),(0,r.kt)("p",null,"LIKE is case sensitive in many SQL implementations so to make a case insensitive match you should either convert the tested value to either all upper or all lower case, for example:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"lower(name) LIKE '%b%'")," matches any name that contains the letters B or b"),(0,r.kt)("p",null,"Note: PostgreSQL also has the non-standard operator ILIKE that can perform a case-insensitive comparison - but avoid this to make code more portable."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"exercise-3"},"Exercise 3"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Which customers are from Norway?"),(0,r.kt)("li",{parentName:"ol"},"Which rooms can accommodate more than two people?"),(0,r.kt)("li",{parentName:"ol"},"Which invoices are dated after one month ago?"),(0,r.kt)("li",{parentName:"ol"},"How would last month's invoices change if we gave a discount of 15%"),(0,r.kt)("li",{parentName:"ol"},"List all customers whose second name starts with 'M' (hint: there's a space before the second name)")),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"using-sql-functions"},"Using SQL Functions"),(0,r.kt)("p",null,"You can use the built-in functions of SQL just as you can in JavaScript, but note that they are different (this is true of most programming languages) but there are also differences between SQL implementations."),(0,r.kt)("p",null,"You use functions to change values, usually of columns, wherever you can use a column, for example, in the selected list of values:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT name, length(name) AS namelen, upper(email)\n  FROM customers;\n")),(0,r.kt)("p",null,"This query also uses a column alias (namelen) to provide a meaningful column heading."),(0,r.kt)("p",null,"Functions are available that operate on all different datatypes."),(0,r.kt)("p",null,"Country names are mixed case so to make sure we always match regardless of the stored case we can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"lower")," function to find all customers from Manchester, UK:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM customers\n   WHERE lower(country) = 'uk'\n     AND city = 'Manchester';\n")),(0,r.kt)("p",null,"Assuming room rates include VAT at 20%, list room rates after VAT increases to 23.5% (from 20%), but round to the nearest pound:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT room_no, room_type, rate AS old_rate,\n       round(rate * 100/120 * 123.5/100) AS new_rate\n   FROM rooms;\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"For further information on SQL functions see the official PostgreSQL documentation at ",(0,r.kt)("a",{parentName:"em",href:"https://www.postgresql.org/docs/12/functions.html"},"https://www.postgresql.org/docs/12/functions.html")," (for version 12 - for other versions change 12 to the required version)")),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"date-and-time-in-sql"},"Date and Time in SQL"),(0,r.kt)("p",null,"In SQL dates and times are held in an internal format but are represented externally (when entering values and displaying them) as strings;"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Text date format: 'YYYY-MM-DD' e.g. '2018-07-21' = 21 July 2018"),(0,r.kt)("li",{parentName:"ul"},"Time format: 'HH:mm:SS.ddd' e.g. '14:32'"),(0,r.kt)("li",{parentName:"ul"},"Date/Time format: 'YYYY-MM-DD HH:mm:SS.ddd' e.g. '2018-07-21 15:26:04'")),(0,r.kt)("p",null,"You can perform arithmetic on dates and times, for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT cust_id, room_no, checkin_date,\n       checkout_date - checkin_date AS nights\n   FROM reservations\n   WHERE checkout_date = current_date + 1;\n")),(0,r.kt)("p",null,"This query performs subtraction of one date from another (",(0,r.kt)("inlineCode",{parentName:"p"},"checkout_date - checkin_date"),") to calculate the number of nights the customer has stayed. It also performs addition (",(0,r.kt)("inlineCode",{parentName:"p"},"current_date + 1"),") to get tomorrow's date so that it lists all reservations that will be checking out tomorrow."),(0,r.kt)("p",null,"Note: ",(0,r.kt)("inlineCode",{parentName:"p"},"current_date")," is a postgres function that returns the current date."),(0,r.kt)("p",null,"Also note that there are many ways to get the same result - you may explore those for yourself."),(0,r.kt)("p",null,"You can also represent time intervals but the representations can be complicated and we shall not cover them here."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"exercise-4"},"Exercise 4"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Write a query to check that all booking dates are before their checkin dates"),(0,r.kt)("li",{parentName:"ol"},"We plan to offer a discount of 10% on all Premier and Premier Plus rooms next month. How much would we gain on each room if occupancy rose by 5 nights over the month."),(0,r.kt)("li",{parentName:"ol"},"List all reservations for this month and the number of nights booked.")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"eliminating-duplicates"},"Eliminating Duplicates"),(0,r.kt)("p",null,'"Which nationalities visit our hotel?":'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT country FROM customers;\n")),(0,r.kt)("p",null,"But how many values do you see returned for each country? If two customers come from a particular country that country will appear twice in the output. If more than two come from the same country then... But we only need to know the different countries."),(0,r.kt)("p",null,"To see each country only once, use the keyword DISTINCT, as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT country FROM customers;\n")),(0,r.kt)("p",null,"The keyword DISTINCT must appear immediately after the keyword SELECT. If more than one column is selected then DISTINCT applies to the combined values of those columns."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"ordering-the-returned-rows"},"Ordering the Returned Rows"),(0,r.kt)("p",null,'If you want to see the data in a specific order, e.g. "List all customers alphabetically by name within each country":'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT id, name, phone, email, country\n    FROM customers\n    ORDER BY country, name;\n")),(0,r.kt)("p",null,"You can can add ASC (ascending, the default) or DESC (descending) after each column name in the ORDER BY clause to control the direction of sorting."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT id, name, country, city\n    FROM customers\n    ORDER BY country DESC, city;\n")),(0,r.kt)("p",null,"This will sort the data into descending alphabetic order of country then ascending order of city name within each country. The output will look something like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"}," id  |          name           |   country    |       city\n-----+-------------------------+--------------+-------------------\n  28 | Kelvin Leong            | USA          | Allentown\n  96 | Juri Yoshido            | USA          | Boston\n 132 | Valarie Franco          | USA          | Boston\n 100 | Allen Nelson            | USA          | Brickhaven\n  46 | Miguel Barajas          | USA          | Brickhaven\n  43 | Leslie Taylor           | USA          | Brickhaven\n  37 | Julie King              | USA          | Bridgewater\n 130 | Sue Taylor              | USA          | Brisbane\n 124 | Steve Thompson          | USA          | Burbank\n  29 | Juri Hashimoto          | USA          | Burlingame\n  36 | Jerry Tseng             | USA          | Cambridge\n  70 | Marta Hernandez         | USA          | Cambridge\n 112 | Dan Lewis               | USA          | Glendale\n  52 | Mary Young              | USA          | Glendale\n  13 | Jean King               | USA          | Las Vegas\n  89 | Brian Chandler          | USA          | Los Angeles\n  97 | Dorothy Young           | USA          | Nashua\n  83 | William Brown           | USA          | Newark\n 120 | Violeta Benitez         | USA          | New Bedford\n  79 | Wing Huang              | USA          | New Bedford\n 116 | Leslie Murphy           | USA          | New Haven\n       . . .\n")),(0,r.kt)("p",null,"Note: you can order by columns that are not returned by the query."),(0,r.kt)("h3",{id:"limiting-the-number-of-rows"},"Limiting the Number of Rows"),(0,r.kt)("p",null,"You can reduce the number of rows returned by using the LIMIT clause at the end of the query:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT id, name, phone, email, country\n  FROM customers\n  ORDER BY country, name\n  LIMIT 20;\n")),(0,r.kt)("p",null,"The LIMIT clause is not normally used without the ORDER BY clause - without the ORDER BY clause rows can be returned in any arbitrary sequence."),(0,r.kt)("p",null,"Not all SQL implementations of SQL support LIMIT, some use TOP while Oracle uses ROWNUM."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"exercise-5"},"Exercise 5"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"List the different room types and rates for all rooms avoiding duplicates."),(0,r.kt)("li",{parentName:"ol"},"List customers' names addresses and phone numbers in alphabetic order of names."),(0,r.kt)("li",{parentName:"ol"},"List customers' names, addresses, city and country in ascending order of country then reverse order of city within country."),(0,r.kt)("li",{parentName:"ol"},"List the room number, type and the cost of staying 5 nights in each of the top 15 most expensive rooms.")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"summary"},"Summary"),(0,r.kt)("p",null,"In this lesson you have learned the use of databases and how relational databases are structured. You've also learned how to use basic single-table query commands in SQL and some of the special 'backslash' commands in ",(0,r.kt)("inlineCode",{parentName:"p"},"psql"),". You have used the SELECT command to control the columns and values that are returned, the DISTINCT, ORDER BY and LIMIT clauses to control the order and numbers of rows returned and you've used the WHERE clause to choose the rows that you access. You have learned the INSERT command to add new data to the database"),(0,r.kt)("p",null,"Next week we shall go on to more complex query constructs including joins, updates and deletes along with incorporating SQL into a node.js server."),(0,r.kt)("h2",{id:"homework"},"Homework"),(0,r.kt)("p",null,"First complete all the exercises for this lesson if you haven't managed to finish them all."),(0,r.kt)("p",null,"All of the homework can be found in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/KeithBremer/Databases-Homework"},"this repository"),"."),(0,r.kt)("h3",{id:"submission"},"Submission"),(0,r.kt)("p",null,"Fork and clone the repository above to get the homework for this week."),(0,r.kt)("p",null,"Create a new branch from ",(0,r.kt)("inlineCode",{parentName:"p"},"Master")," to start working on this weeks homework. It should be called ",(0,r.kt)("inlineCode",{parentName:"p"},"[YOUR_NAME]/Week1"),"."),(0,r.kt)("p",null,"When you have completed the homework create a pull request back to the parent repository so your teacher(s) can feedback on it."),(0,r.kt)("h3",{id:"tasks"},"Tasks"),(0,r.kt)("p",null,"You should complete all of the tasks in ",(0,r.kt)("strong",{parentName:"p"},"Week 1")," of the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/KeitBremer/Databases-Homework"},"Database Homework repository"),"."))}p.isMDXComponent=!0},10433:function(e,t,a){t.Z=a.p+"assets/files/build-hotel-3bafb9ca4233daeba5f9e1fba15caf59.sql"},78011:function(e,t,a){t.Z=a.p+"assets/images/hotel_tables-a45db62ba108d1171b67754a9628ba56.png"},92568:function(e,t,a){t.Z=a.p+"assets/images/table-diagram-c2f05eb31e66cf61b99697863d78761a.png"}}]);