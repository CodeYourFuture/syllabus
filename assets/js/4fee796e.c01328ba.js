(self.webpackChunkcodeyourfuture_syllabus=self.webpackChunkcodeyourfuture_syllabus||[]).push([[5904],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return p},kt:function(){return u}});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=d(a),u=o,h=c["".concat(s,".").concat(u)]||c[u]||m[u]||r;return a?n.createElement(h,i(i({ref:t},p),{},{components:a})):n.createElement(h,i({ref:t},p))}));function u(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var d=2;d<r;d++)i[d]=a[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},7723:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var n=a(7294);function o(e){var t="https://docs.google.com/forms/d/e/1FAIpQLScq8Zgr0pz7aMDj0D768eCpW798XgtDsKfpA6BquqK5Hdtj4A/viewform?embedded=true&entry.1672476057="+e.module.replace(" ","+")+"&entry.74981796="+e.week.replace(" ","+");return n.createElement("div",{className:"feedback"},n.createElement("div",{className:"feedback__wrapper"},n.createElement("iframe",{src:t,width:"640",height:"640",frameborder:"0",marginheight:"0",marginwidth:"0"},"Loading\u2026"),n.createElement("center",null,n.createElement("p",null,"Not loading? Form can be found"," ",n.createElement("a",{target:"_blank",href:t},"here"),". Click"," ",n.createElement("a",{target:"_blank",href:"https://docs.google.com/forms/d/1F2mB10japkHAPb3H-9Q4YrYH0i61GoMG1tk-P4ZT808/edit"},"here")," ","to get edit access."))))}},7343:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return l},metadata:function(){return s},toc:function(){return d},default:function(){return m}});var n=a(4034),o=a(9973),r=(a(7294),a(3905)),i=a(7723),l={id:"lesson",title:"Database 2-  More SQL and integration with NodeJS",sidebar_label:"Lesson"},s={unversionedId:"db/week-2/lesson",id:"db/week-2/lesson",isDocsHomePage:!1,title:"Database 2-  More SQL and integration with NodeJS",description:"What will we learn today?",source:"@site/docs/db/week-2/lesson.md",sourceDirName:"db/week-2",slug:"/db/week-2/lesson",permalink:"/db/week-2/lesson",editUrl:"https://github.com/CodeYourFuture/Syllabus-V2/edit/master/docs/db/week-2/lesson.md",version:"current",sidebar_label:"Lesson",frontMatter:{id:"lesson",title:"Database 2-  More SQL and integration with NodeJS",sidebar_label:"Lesson"},sidebar:"SQL",previous:{title:"Coursework",permalink:"/db/week-1/homework"},next:{title:"Instructor Notes",permalink:"/db/week-2/instructors"}},d=[{value:"What will we learn today?",id:"what-will-we-learn-today",children:[]},{value:"Learning Objectives",id:"learning-objectives",children:[]},{value:"More SQL",id:"more-sql",children:[{value:"Changing the definition of a table",id:"changing-the-definition-of-a-table",children:[]},{value:"Dropping a table",id:"dropping-a-table",children:[]},{value:"Updating a row",id:"updating-a-row",children:[]},{value:"Deleting a row",id:"deleting-a-row",children:[]},{value:"Joining tables",id:"joining-tables",children:[]},{value:"Other useful operations",id:"other-useful-operations",children:[]}]},{value:"Integration with NodeJS",id:"integration-with-nodejs",children:[{value:"Introduction to node-postgres",id:"introduction-to-node-postgres",children:[]},{value:"Loading data from a database with a GET endpoint",id:"loading-data-from-a-database-with-a-get-endpoint",children:[]}]},{value:"Coursework",id:"coursework",children:[]},{value:"Feedback",id:"feedback",children:[]}],p={toc:d};function m(e){var t=e.components,l=(0,o.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,n.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"what-will-we-learn-today"},"What will we learn today?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Revision from last week"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#more-sql"},"More SQL"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Changing the definition of a table"),(0,r.kt)("li",{parentName:"ul"},"Dropping a table"),(0,r.kt)("li",{parentName:"ul"},"Updating a row"),(0,r.kt)("li",{parentName:"ul"},"Deleting a row"),(0,r.kt)("li",{parentName:"ul"},"Join tables"),(0,r.kt)("li",{parentName:"ul"},"Other useful operations"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#integration-with-nodejs"},"Integration with NodeJS"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Introduction to node-postgres"),(0,r.kt)("li",{parentName:"ul"},"Loading data from a database with a GET endpoint"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#coursework"},"Coursework"))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"learning-objectives"},"Learning Objectives"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add and remove columns in a pre-existing table using PostgreSQL using ",(0,r.kt)("inlineCode",{parentName:"li"},"ALTER")),(0,r.kt)("li",{parentName:"ul"},"Rename tables and columns in a pre-existing table using PostgreSQL using ",(0,r.kt)("inlineCode",{parentName:"li"},"DELETE")),(0,r.kt)("li",{parentName:"ul"},"Update rows in a pre-existing table using PostgreSQL using ",(0,r.kt)("inlineCode",{parentName:"li"},"UPDATE")),(0,r.kt)("li",{parentName:"ul"},"Combine tables together using PostgreSQL using ",(0,r.kt)("inlineCode",{parentName:"li"},"INNER JOIN")),(0,r.kt)("li",{parentName:"ul"},"Connect a PostgreSQL database to a NodeJS application"),(0,r.kt)("li",{parentName:"ul"},"Retrieve data from a PostgreSQL database in a NodeJS application")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"more-sql"},"More SQL"),(0,r.kt)("p",null,"For the following, use the file ",(0,r.kt)("a",{target:"_blank",href:a(9877).Z},(0,r.kt)("code",null,"cyf_hotels_exercise5.sql"))," from the previous class to reinitialise your database with ",(0,r.kt)("inlineCode",{parentName:"p"},"psql -d cyf_hotels -f cyf_hotels_exercise5.sql"),"."),(0,r.kt)("h3",{id:"changing-the-definition-of-a-table"},"Changing the definition of a table"),(0,r.kt)("p",null,"Sometimes, you may need to change the definition of a table you created before without deleting it. Such changes include renaming a table, adding/removing a column, changing the name of a column, changing the type of a column etc... The general syntax to perform these operations is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE table_name action;\n")),(0,r.kt)("p",null,"For example, to add a new column to the existing ",(0,r.kt)("inlineCode",{parentName:"p"},"customers")," table:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE customers ADD COLUMN date_of_birth DATE;\n")),(0,r.kt)("p",null,"To delete an existing column from the ",(0,r.kt)("inlineCode",{parentName:"p"},"customers")," table:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE customers DROP COLUMN date_of_birth;\n")),(0,r.kt)("p",null,"To rename the table ",(0,r.kt)("inlineCode",{parentName:"p"},"customers")," into ",(0,r.kt)("inlineCode",{parentName:"p"},"clients"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE customers RENAME TO clients;\n")),(0,r.kt)("p",null,"For more examples, you can consult the following tutorial: ",(0,r.kt)("a",{parentName:"p",href:"http://www.postgresqltutorial.com/postgresql-alter-table/"},"Postgres alter table"),"."),(0,r.kt)("h4",{id:"exercise-1"},"Exercise 1"),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Exercise")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ol",{parentName:"div"},(0,r.kt)("li",{parentName:"ol"},"Add a column ",(0,r.kt)("inlineCode",{parentName:"li"},"date_of_birth")," of type ",(0,r.kt)("inlineCode",{parentName:"li"},"DATE")," in the ",(0,r.kt)("inlineCode",{parentName:"li"},"customers")," table."),(0,r.kt)("li",{parentName:"ol"},"Rename the column ",(0,r.kt)("inlineCode",{parentName:"li"},"date_of_birth")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"birthdate")," in the ",(0,r.kt)("inlineCode",{parentName:"li"},"customers")," table."),(0,r.kt)("li",{parentName:"ol"},"Delete the column ",(0,r.kt)("inlineCode",{parentName:"li"},"birthdate")," from the ",(0,r.kt)("inlineCode",{parentName:"li"},"customers")," table")))),(0,r.kt)("h3",{id:"dropping-a-table"},"Dropping a table"),(0,r.kt)("p",null,"To delete the table ",(0,r.kt)("inlineCode",{parentName:"p"},"customers"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DROP TABLE customers;\n")),(0,r.kt)("h4",{id:"exercise-2"},"Exercise 2"),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Exercise")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ol",{parentName:"div"},(0,r.kt)("li",{parentName:"ol"},"Create a new table ",(0,r.kt)("inlineCode",{parentName:"li"},"test")),(0,r.kt)("li",{parentName:"ol"},"Drop the table ",(0,r.kt)("inlineCode",{parentName:"li"},"test"))))),(0,r.kt)("h3",{id:"updating-a-row"},"Updating a row"),(0,r.kt)("p",null,"The general construction to update a row is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"UPDATE table SET column1 = value1, column2 = value2 WHERE condition;\n")),(0,r.kt)("p",null,"For example, to update the name and country of the customers with ID 3:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"UPDATE customers SET name='Bob Marley', country='Jamaica' WHERE id=3;\n")),(0,r.kt)("h4",{id:"exercise-3"},"Exercise 3"),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Exercise")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"Update the postcode of the hotel named ",(0,r.kt)("inlineCode",{parentName:"li"},"Elder Lake Hotel")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"L10XYZ")),(0,r.kt)("li",{parentName:"ul"},"Update the number of rooms of ",(0,r.kt)("inlineCode",{parentName:"li"},"Cozy Hotel")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"25")),(0,r.kt)("li",{parentName:"ul"},"For the customer named ",(0,r.kt)("inlineCode",{parentName:"li"},"Nadia Sethuraman"),", update her address to ",(0,r.kt)("inlineCode",{parentName:"li"},"2 Blue Street"),", her city to ",(0,r.kt)("inlineCode",{parentName:"li"},"Glasgow")," and her postcode to ",(0,r.kt)("inlineCode",{parentName:"li"},"G11ABC")," in one query"),(0,r.kt)("li",{parentName:"ul"},"Update all the bookings of customer with ID ",(0,r.kt)("inlineCode",{parentName:"li"},"1")," for the hotel with ID ",(0,r.kt)("inlineCode",{parentName:"li"},"1")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"5")," nights in one query")))),(0,r.kt)("h3",{id:"deleting-a-row"},"Deleting a row"),(0,r.kt)("p",null,"The syntax to delete a row is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM table WHERE condition;\n")),(0,r.kt)("p",null,"For example, to delete the booking with ID 4:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM bookings WHERE id=4;\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTE:")," If you don't supply a ",(0,r.kt)("inlineCode",{parentName:"p"},"WHERE")," clause with ",(0,r.kt)("inlineCode",{parentName:"p"},"DELETE")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"UPDATE")," the command will be applied to ",(0,r.kt)("strong",{parentName:"p"},"all")," the rows in the table which is rarely what you want."),(0,r.kt)("h4",{id:"exercise-4"},"Exercise 4"),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Exercise")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"Delete the booking of customer ID ",(0,r.kt)("inlineCode",{parentName:"li"},"8")," for the date ",(0,r.kt)("inlineCode",{parentName:"li"},"2020-01-03")),(0,r.kt)("li",{parentName:"ul"},"Delete all the bookings of customer ID ",(0,r.kt)("inlineCode",{parentName:"li"},"6")),(0,r.kt)("li",{parentName:"ul"},"Delete the customer with ID ",(0,r.kt)("inlineCode",{parentName:"li"},"6"))))),(0,r.kt)("h3",{id:"joining-tables"},"Joining tables"),(0,r.kt)("p",null,"Sometimes, you will need to retrieve data which are spread in different tables in a single response. For this purpose, you will need to join tables together. The general syntax is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT A.column1, B.column2 FROM A INNER JOIN B ON A.b_id=B.id;\n")),(0,r.kt)("p",null,"For example, to load all the bookings along with customer data:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM customers INNER JOIN bookings ON customers.id=bookings.customer_id;\n")),(0,r.kt)("p",null,"To load all the bookings along with customer data and hotel data:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM bookings\nINNER JOIN customers ON customers.id=bookings.customer_id\nINNER JOIN hotels ON hotels.id=bookings.hotel_id;\n")),(0,r.kt)("p",null,"To load the booking checkin dates for customer ID ",(0,r.kt)("inlineCode",{parentName:"p"},"1")," along with the customer name and the hotel name:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT bookings.checkin_date,customers.name,hotels.name FROM bookings\nINNER JOIN customers ON customers.id=bookings.customer_id\nINNER JOIN hotels ON hotels.id=bookings.hotel_id\nWHERE customers.id=1;\n")),(0,r.kt)("h4",{id:"exercise-5"},"Exercise 5"),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Exercise")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"Try and understand each of the queries above in your ",(0,r.kt)("inlineCode",{parentName:"li"},"psql")," prompt"),(0,r.kt)("li",{parentName:"ul"},"Retrieve all the bookings along with customer data for bookings starting in 2020"),(0,r.kt)("li",{parentName:"ul"},"Retrieve the customer names, booking start dates and number of nights for all customers who booked the hotel name ",(0,r.kt)("inlineCode",{parentName:"li"},"Jade Peaks Hotel")),(0,r.kt)("li",{parentName:"ul"},"Retrieve all the booking start dates with customer names and hotel names for all bookings for more than 5 nights")))),(0,r.kt)("h3",{id:"other-useful-operations"},"Other useful operations"),(0,r.kt)("p",null,"Ordering the result:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM table ORDER BY column;\n")),(0,r.kt)("p",null,'This will sort the returned rows in the ascending order for "column". To sort them in descending order, use:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM table ORDER BY column DESC;\n")),(0,r.kt)("p",null,"Limiting the number of results returned:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM table LIMIT 10;\n")),(0,r.kt)("p",null,"Returning all customers whose ID is 1, 2, 3 or 4:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM customers WHERE id IN (1,2,3,4);\n")),(0,r.kt)("p",null,"Query by pattern matching, for example retrieve all customers whose name starts with Bob:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM customers WHERE name LIKE 'Bob%';\n")),(0,r.kt)("p",null,"You can combine different operations together, for example, if you want to retrieve all the booking start dates with the customer names and hotel names for customer names starting with the letter ",(0,r.kt)("inlineCode",{parentName:"p"},"M")," ordered by hotel name with a limit of 3 results:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT bookings.checkin_date,customers.name,hotels.name FROM bookings\nINNER JOIN customers ON customers.id=bookings.customer_id\nINNER JOIN hotels ON hotels.id=bookings.hotel_id\nWHERE customers.name LIKE 'M%'\nORDER BY hotels.name\nLIMIT 3;\n")),(0,r.kt)("h4",{id:"exercise-6"},"Exercise 6"),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Exercise")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"Retrieve all customers whose name starts with the letter ",(0,r.kt)("inlineCode",{parentName:"li"},"S")),(0,r.kt)("li",{parentName:"ul"},"Retrieve all hotels which have the word ",(0,r.kt)("inlineCode",{parentName:"li"},"Hotel")," in their name"),(0,r.kt)("li",{parentName:"ul"},"Retrieve the booking start date, customer name, hotel name for the top 5 bookings ordered by number of nights in descending order")))),(0,r.kt)("h2",{id:"integration-with-nodejs"},"Integration with NodeJS"),(0,r.kt)("h3",{id:"introduction-to-node-postgres"},"Introduction to node-postgres"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},'"node-postgres is a collection of node.js modules for interfacing with your PostgreSQL database."')," - ",(0,r.kt)("a",{parentName:"p",href:"https://node-postgres.com/"},"https://node-postgres.com/")),(0,r.kt)("p",null,"In the following, we will use ",(0,r.kt)("em",{parentName:"p"},"node-postgres")," to..."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Connect to a database"),(0,r.kt)("li",{parentName:"ol"},"Send SQL query to the database and get results")),(0,r.kt)("h3",{id:"loading-data-from-a-database-with-a-get-endpoint"},"Loading data from a database with a GET endpoint"),(0,r.kt)("p",null,"Let's build a brand new NodeJS application with a single GET endpoint to load the list of hotels that you already have in the ",(0,r.kt)("inlineCode",{parentName:"p"},"hotels")," table of the ",(0,r.kt)("inlineCode",{parentName:"p"},"cyf_hotels")," database."),(0,r.kt)("p",null,"First, create a new NodeJS application that we will call ",(0,r.kt)("strong",{parentName:"p"},"cyf-hotels-api")," (enter ",(0,r.kt)("inlineCode",{parentName:"p"},"server.js")," when asking about the entry point):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir cyf-hotels-api && cd cyf-hotels-api && npm init\n")),(0,r.kt)("p",null,"As before, we will use the Express library to build our API, and the node-postgres library to connect with our database:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install --save express\nnpm install --save pg\n")),(0,r.kt)("p",null,"Create a ",(0,r.kt)("inlineCode",{parentName:"p"},"server.js")," file, import express, initialise the server and start listening for requests:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const express = require("express");\nconst app = express();\n\napp.listen(3000, function() {\n    console.log("Server is listening on port 3000. Ready to accept requests!");\n});\n')),(0,r.kt)("p",null,"Import pg library and create a new GET endpoint to load the list of hotels:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const { Pool } = require('pg');\n\nconst pool = new Pool({\n    user: 'postgres',\n    host: 'localhost',\n    database: 'cyf_hotels',\n    password: '',\n    port: 5432\n});\n\napp.get(\"/hotels\", function(req, res) {\n    pool.query('SELECT * FROM hotels')\n        .then((result) => res.json(result.rows))\n        .catch((error) => {\n            console.error(error);\n            res.status(500).json(error);\n        });\n});\n")),(0,r.kt)("p",null,"In the code above:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"We first import the ",(0,r.kt)("inlineCode",{parentName:"li"},"Pool")," class from the pg library, which is used to connect to a database"),(0,r.kt)("li",{parentName:"ul"},"We create a new pool where we specify the credentials to connect to the cyf_hotels database"),(0,r.kt)("li",{parentName:"ul"},"We then create a new /hotels endpoint where we use the method ",(0,r.kt)("inlineCode",{parentName:"li"},"query()")," to send a SQL query to load all the hotels from the table ",(0,r.kt)("inlineCode",{parentName:"li"},"hotels")," and return the results with ",(0,r.kt)("inlineCode",{parentName:"li"},"result.rows"),". You can write any valid SQL query that you learned in the ",(0,r.kt)("inlineCode",{parentName:"li"},"query()")," method!"),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"query()")," method returns a ",(0,r.kt)("em",{parentName:"li"},"promise"),". It is very similar to how the ",(0,r.kt)("inlineCode",{parentName:"li"},"fetch")," API works in the browser.")),(0,r.kt)("p",null,"Start your server with ",(0,r.kt)("inlineCode",{parentName:"p"},"node server.js")," and try to reach the ",(0,r.kt)("inlineCode",{parentName:"p"},"/hotels")," endpoint to see the list of hotels currently available in your ",(0,r.kt)("inlineCode",{parentName:"p"},"hotels")," table of your ",(0,r.kt)("inlineCode",{parentName:"p"},"cyf_hotels")," database. You can try to create/update/delete hotels to verify that your API always returns what is stored in your database."),(0,r.kt)("h2",{id:"coursework"},"Coursework"),(0,r.kt)("p",null,"All of the coursework for this week can be found ",(0,r.kt)("a",{parentName:"p",href:"./homework"},"here"),"."),(0,r.kt)("h2",{id:"feedback"},"Feedback"),(0,r.kt)("p",null,"Please spend two minutes reviewing this lesson to help us improve it for the future. This feedback will be shared with volunteers."),(0,r.kt)(i.Z,{module:"SQL",week:"Week 2",mdxType:"Feedback"}))}m.isMDXComponent=!0},9877:function(e,t,a){"use strict";t.Z=a.p+"assets/files/cyf_hotels_exercise5-88cc17362572ef85a70785dc2ceb21e9.sql"}}]);